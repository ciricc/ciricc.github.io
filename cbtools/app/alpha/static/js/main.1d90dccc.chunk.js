(this["webpackJsonpchatbot-tools"]=this["webpackJsonpchatbot-tools"]||[]).push([[0],{174:function(e,t,a){e.exports=a(289)},264:function(e,t,a){},265:function(e,t,a){},285:function(e,t,a){},286:function(e,t,a){},287:function(e,t,a){},288:function(e,t,a){},289:function(e,t,a){"use strict";a.r(t);a(175),a(201),a(203),a(204),a(206),a(207),a(208),a(209),a(210),a(211),a(212),a(213),a(215),a(216),a(217),a(218),a(219),a(220),a(221),a(222),a(223),a(224),a(226),a(227),a(228),a(229),a(230),a(231),a(232),a(233),a(234),a(235),a(236),a(237),a(238),a(239),a(240),a(241),a(242),a(243);var n=a(0),r=a.n(n),s=a(40),i=a.n(s),o=a(6),c=a.n(o),l=a(4),u=a.n(l),d=a(28),h=a(8),p=a(11),m=a(12),f=a(13),v=a(14),y=(a(252),a(1)),g=(a(263),a(46)),b=(a(78),function e(){console.log("smooth to top");var t=document.documentElement.scrollTop||document.body.scrollTop;t>0?(window.scrolling=!0,window.requestAnimationFrame(e),window.scrollTo(0,t-t/3)):window.scrolling=!1}),k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return String(e).toLowerCase().split(t).filter((function(e){return!!e}))},_=(a(264),function(e){var t=e.onChange,a=(e.onClose,e.closeIcon,e.key),n=e.title,s=e.setSearch,i=e.hashParams,o=e.after,c="desktop_web"===i.get("vk_platform");return console.log(i.get("vk_platform")),r.a.createElement(r.a.Fragment,null,r.a.createElement(y.t,{key:a},s?r.a.createElement(y.x,{onChange:t,className:c?"":"margins"}):r.a.createElement("div",{onClick:function(){b()}},n||(i.get("title")?i.get("title"):"ChatBot Tools"))),o)}),C=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).saveScrolls=function(e){n.scrolls[n.state.page]=window.pageYOffset},n.selectCountry=function(e){"selectCountry"===n.props.activeHash?n.props.sendResponse({country_id:e,country_title:n.state.countries.find((function(t){return t.id===e})).title}):n.setState({selectedCountryId:e,page:"cities"},(function(){n.loadCities()}))},n.selectCity=function(){var e=Object(h.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.props.hashParams,n.props.sendResponse({city_id:t.id,city_title:t.title,country_id:n.state.selectedCountryId,country_title:a.get("country_id")&&n.state.countryName?n.state.countryName:n.state.countries.find((function(e){return e.id===n.state.selectedCountryId})).title}),n.clearCities();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.clearCities=function(){n.props.hashParams.get("country_id")&&!n.state.countries.length&&n.loadCountries(),n.setState({cities:[],selectedCountryId:0,countryName:""})},n.changeSearchQuery=function(e){var t=e.target.value;n.state.selectedCountryId?n.loadCities(t):n.setState({countryName:String(t).toLocaleLowerCase()})},n.state={countries:[],cities:[],selectedCountryId:0,loadedCountries:!1,loadedCities:!1,countryName:"",page:"countries"},n.scrolls=Object(g.a)({countries:0},"countries",0),n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.props.hashParams.get("country_id")?this.goToCities():this.state.countries.length||this.loadCountries(),window.addEventListener("scroll",this.saveScrolls,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.saveScrolls)}},{key:"componentDidUpdate",value:function(){window.scrollTo(0,this.scrolls[this.state.page])}},{key:"goToCities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCountriesById",{country_ids:Number(a.get("country_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCountryId:r.id,countryName:r.title,loadedCountries:!0,page:"cities"},(function(){s.loadCities()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCountries",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedCountries:!1}),e.next=4,this.props.vkApi("database.getCountries",{need_all:1,q:t,count:1e3});case 4:a=e.sent,this.setState({loadedCountries:!0,countries:a.items});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedCities:!1}),e.next=4,this.props.vkApi("database.getCities",{country_id:this.state.selectedCountryId,q:t});case 4:a=e.sent,this.setState({loadedCities:!0,cities:a.items});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderCities",value:function(){var e=this,t=this.state,a=t.cities,n=t.loadedCities,s="no"!==this.props.hashParams.get("can_change_country");return a.length||n?a.length?r.a.createElement("div",null,r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:s?r.a.createElement(y.q,{onClick:this.clearCities},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0443"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043e\u0440\u043e\u0434")},r.a.createElement(y.r,null,a.map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectCity(t)},key:"city"+t.id},t.title)}))))):r.a.createElement(y.h,null,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430"):r.a.createElement(y.u,{size:"l"})}},{key:"render",value:function(){var e=this,t=this.state,a=t.countries,n=t.loadedCountries,s=t.countryName,i=t.selectedCountryId,o=this.props.hashParams,c=o.get("country_id");return r.a.createElement(y.s,{id:this.props.id},r.a.createElement(_,{hashParams:o,setSearch:!0,key:i?"country":"city",onChange:this.changeSearchQuery}),!a.length&&!n||c&&!n||!n?r.a.createElement(y.u,{size:"l"}):!a.length&&c&&n&&!s?r.a.createElement(y.h,null,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430"):i?this.renderCities():r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary"},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0443")},r.a.createElement(y.r,null,a.filter((function(e){return String(e.title).toLocaleLowerCase().match(s)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectCountry(t.id)},key:"country"+t.id},t.title)})))))}}]),a}(r.a.Component),E=a(117),w=a.n(E),S=function(e){var t=e.onRequestToken,a=e.id,n=e.activeHash,s=e.hashParams;return r.a.createElement(y.s,{id:a,centered:!0},r.a.createElement(_,{hashParams:s}),r.a.createElement(y.v,{icon:r.a.createElement(w.a,null),action:r.a.createElement(y.b,{size:"xl",onClick:t},"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c")},"\u0427\u0442\u043e\u0431\u044b ",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e){case"selectCity":return"\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0433\u043e\u0440\u043e\u0434";default:return"\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u043c"}}(n),", \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043e\u0431\u0449\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0432\u0430\u0441."))},x=function(e){var t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a,title:"ChatBot Tools"}),r.a.createElement(y.h,{className:"align-center"},"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430. ",r.a.createElement("br",null),"\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043c\u0435\u0442\u043e\u0434\u0430."))},P=a(118),A=a.n(P),O=a(57),j=a.n(O),I=function(e){var t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a,title:"\u041f\u0440\u0438\u0432\u0435\u0442!"}),r.a.createElement(y.v,{icon:r.a.createElement(j.a,null),header:"ChatBot Tools",action:r.a.createElement(y.b,{size:"xl",onClick:function(){c.a.send("VKWebAppAddToCommunity",{})},before:r.a.createElement(A.a,null)},"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e")},"\u042d\u0442\u043e \u043d\u043e\u0432\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0412\u0430\u0448\u0438\u0445 ",r.a.createElement("br",null)," \u0447\u0430\u0442-\u0431\u043e\u0442\u043e\u0432 \u0412\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435."))},R=a(119),T=a.n(R),N=(a(265),function(e){var t=e.hashParams,a=e.requests,n=e.onClick,s=e.actionText,i=e.action,o=e.icon,c=e.nameField,l=e.photoField,u=e.content,d=void 0===u?null:u,h=e.hideButton,p=e.showSpinner,m=void 0!==p&&p;c||(c="bot_name"),l||(l="bot_photo");var f=t.get(c)||"\u0427\u0430\u0442-\u0431\u043e\u0442",v=t.get(l)||"";return r.a.createElement(y.d,null,r.a.createElement(y.c,{mode:"tint",className:"full-size-card"},r.a.createElement(y.v,{icon:v?r.a.createElement(y.a,{size:82,src:v}):o||r.a.createElement(T.a,null),header:f,action:i||(h?null:r.a.createElement(y.b,{size:"xl",before:m?r.a.createElement(y.z,{size:"small",className:"white-spinner"}):null,onClick:n},s||"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c"))},a,r.a.createElement("div",{style:{textAlign:"left",marginTop:12}},d))))}),F=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).getEmail=function(){c.a.supports("VKWebAppGetEmail")?c.a.send("VKWebAppGetEmail",{}).then((function(t){e.props.sendResponse({email:t.email})})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c email",t)})):e.props.sendError("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 email \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.getEmail,hashParams:a,requests:"\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0412\u0430\u0448\u0435\u043c\u0443 email \u0430\u0434\u0440\u0435\u0441\u0443"}))}}]),a}(r.a.Component),M=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).getPhoneNumber=function(){c.a.supports("VKWebAppGetPhoneNumber")?c.a.send("VKWebAppGetPhoneNumber",{}).then((function(t){e.props.sendResponse({phone_number:t.phone_number})})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",t)})):e.props.sendError("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.getPhoneNumber,hashParams:a,requests:"\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0412\u0430\u0448\u0435\u043c\u0443 \u043d\u043e\u043c\u0435\u0440\u0443 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430"}))}}]),a}(r.a.Component),U=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).joinGroup=function(){var t=e.props.hashParams;c.a.supports("VKWebAppJoinGroup")?c.a.send("VKWebAppJoinGroup",{group_id:Number(t.get("group_id"))}).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0432\u0441\u0442\u0443\u043f\u0438\u0442\u044c \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e",t)})):e.props.sendError("\u0412\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.joinGroup,hashParams:a,requests:"\u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u0432\u0441\u0442\u0443\u043f\u0438\u0442\u044c \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e",actionText:"\u0412\u0441\u0442\u0443\u043f\u0438\u0442\u044c",photoField:"group_photo",nameField:"group_name"}))}}]),a}(r.a.Component),V=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).subscribeGroupMessages=function(){var t=e.props.hashParams;c.a.send("VKWebAppAllowMessagesFromGroup",{group_id:Number(t.get("group_id")),key:t.get("key")}).then((function(t){e.props.sendResponse(t)}))},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.subscribeGroupMessages,hashParams:a,requests:"\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443 \u043d\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430",actionText:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f"}))}}]),a}(r.a.Component),q=a(130),H=a(58),W=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).routeDialog=function(){var t,a={},n=Object(H.a)(e.props.hashParams);try{for(n.s();!(t=n.n()).done;){var r=Object(q.a)(t.value,2),s=r[0],i=r[1];a[s]=i}}catch(o){n.e(o)}finally{n.f()}return e.props.sendResponse(a),!0},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(y.m,null,r.a.createElement(N,{hashParams:a,requests:"\u041f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a \u0434\u0438\u0430\u043b\u043e\u0433\u0443 \u0441 \u0447\u0430\u0442-\u0431\u043e\u0442\u043e\u043c",icon:r.a.createElement(j.a,null),action:r.a.createElement(y.q,{href:"https://vk.com/im?sel=-"+a.get("bot_id"),onClick:this.routeDialog,target:"_blank"},r.a.createElement(y.b,{size:"xl"},a.get("action_text")?a.get("action_text"):"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0434\u0438\u0430\u043b\u043e\u0433"))})))}}]),a}(r.a.Component),L=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentWillMount",value:function(){var e=this;c.a.supports("VKWebAppGetClientVersion")?c.a.send("VKWebAppGetClientVersion",{}).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u0444\u043d\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438",t)})):this.props.sendError("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0432\u0435\u0440\u0441\u0438\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435",{error_code:"not_supports"})}},{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0432\u0435\u0440\u0441\u0438\u044e ...")}}]),a}(r.a.Component),Q=a(120),B=a.n(Q),K=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).scanQR=function(){c.a.supports("VKWebAppOpenCodeReader")?c.a.send("VKWebAppOpenCodeReader",{}).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("QR \u043d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c",t)})):e.props.sendError("\u0427\u0442\u0435\u043d\u0438\u0435 QR \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{hashParams:a,requests:"\u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c QR",action:r.a.createElement(y.b,{size:"xl",onClick:this.scanQR,before:r.a.createElement(B.a,null)},"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c")}))}}]),a}(r.a.Component),G=a(121),z=a.n(G),D=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).downloadFile=function(){var t=e.props.hashParams;window.isAndroid||window.isWEB||(c.a.supports("VKWebAppDownloadFile")?c.a.send("VKWebAppDownloadFile",{url:t.get("file_url"),filename:t.get("file_name")}).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b",t)})):e.props.sendError("\u0421\u043a\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435",{error_code:"not_supports"}))},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams,n=window.isAndroid||window.isWEB;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.downloadFile,hashParams:a,requests:"\u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b",action:r.a.createElement(y.b,{before:r.a.createElement(z.a,null),size:"xl",onClick:n?null:this.downloadFile,href:n?a.get("file_url"):null,download:n?a.get("file_name"):null,target:"_blank"},"\u0421\u043a\u0430\u0447\u0430\u0442\u044c")}))}}]),a}(r.a.Component),J=a(45),Y=a(60),X=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).handleInput=function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=e.currentTarget.value;"checkbox"===e.currentTarget.type&&(t=e.currentTarget.checked);var a=Object(d.a)({},n.state.formQuery);a.fields.forEach((function(n,r){if(n.name===e.currentTarget.name&&(a.fields[r].value=t,a.fields[r].isValid=null,a.fields[r].bottomMessage=null,n.options.match&&-1===["select","radio","checkbox"].indexOf(n.type))){var s=Array.isArray(n.options.match)?n.options.match[0]:n.options.match,i=Array.isArray(n.options.match)?n.options.match[1]:"",o=new RegExp(s,i);n.value.match(o)?a.fields[r].isValid=!0:a.fields[r].isValid=!1}})),n.setState({formQuery:a})},n.submitForm=function(e){if(e.preventDefault(),n.formIsValid()){var t={};n.state.formQuery.fields.forEach((function(e){t[e.name]=e.value})),console.info("is valid",t),n.props.sendResponse(t)}};var r=e.hashParams.get("form"),s=!1;if("[object Object]"!==Object.prototype.toString.call(r)&&r.length)try{r=JSON.parse(r),s=!0}catch(o){s=!1}else s=!0;if(!s)return Object(Y.a)(n,n.props.sendError("\u0424\u043e\u0440\u043c\u0430 \u043d\u0435 \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0430 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e JSON[]",{error_code:"invalid_format"}));var i=r.action_text||"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c";return r.fields&&Array.isArray(r.fields)&&r.fields.forEach((function(e,t){var a=e.type,n=e.name,s=e.default_value,i=e.options,o=e.required;r.fields[t]={defaultValue:s,value:s||null,required:o,options:i,name:n,type:a,isValid:null}})),n.state=Object(d.a)({},{},{actionText:i,formQuery:r}),n}return Object(m.a)(a,[{key:"renderTextField",value:function(e){return r.a.createElement(y.p,{name:e.name,defaultValue:e.defaultValue,placeholder:e.options.placeholder,maxLength:e.options.max_length,type:e.inputType||"text",top:e.options.top?e.options.top+(e.required?" *":""):"",onChange:this.handleInput,bottom:e.bottomMessage,status:null===e.isValid?null:e.isValid?"valid":"error"})}},{key:"renderSelectField",value:function(e){return r.a.createElement(y.y,null)}},{key:"renderTextAreaField",value:function(e){return r.a.createElement(y.A,{name:e.name,defaultValue:e.defaultValue,placeholder:e.options.placeholder,maxLength:e.options.max_length,top:e.options.top?e.options.top+(e.required?" *":""):"",onChange:this.handleInput,bottom:e.bottomMessage,status:null===e.isValid?null:e.isValid?"valid":"error"})}},{key:"renderCheckboxField",value:function(e){return r.a.createElement(y.f,{name:e.name,defaultChecked:e.defaultValue,onChange:this.handleInput,top:e.options.top?e.options.top+(e.required?" *":""):"",bottom:e.bottomMessage},e.options.text)}},{key:"renderRadioField",value:function(e){var t=this;return e.options.items&&Array.isArray(e.options.items)?r.a.createElement(y.l,{top:e.options.top?e.options.top+(e.required?" *":""):"",status:null===e.isValid?null:e.isValid?"valid":"error",bottom:e.bottomMessage},e.options.items.map((function(a){return r.a.createElement(y.w,{name:e.name,defaultChecked:e.defaultValue===a.value,onChange:t.handleInput,description:a.description,value:a.value},a.text)}))):null}},{key:"renderRow",value:function(e){switch(e.type){case"text":return this.renderTextField(e);case"select":return this.renderSelectField(e);case"textarea":return this.renderTextAreaField(e);case"checkbox":return this.renderCheckboxField(e);case"radio":return this.renderRadioField(e);case"password":return this.renderTextField(Object(d.a)({},e,{inputType:"password"}));default:return null}}},{key:"formIsValid",value:function(){var e=!0,t=Object(d.a)({},this.state.formQuery),a=t.fields||[];return(a=Object(J.a)(a)).forEach((function(t,n){if(t.required&&!t.value&&-1===["select"].indexOf(t.type)&&(e=!1,t.isValid=!1,t.bottomMessage="\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e"),t.value){if(t.options.same_with){var r=a.find((function(e){return e.name===t.options.same_with}));r&&(r=r.value)!==t.value&&(e=!1,t.isValid=!1,t.bottomMessage="\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u043f\u043e\u043b\u0435\u043c "+t.options.same_with)}if(t.options.match&&-1===["select","radio","checkbox"].indexOf(t.type)){var s=Array.isArray(t.options.match)?t.options.match[0]:t.options.match,i=Array.isArray(t.options.match)?t.options.match[1]:"",o=new RegExp(s,i);t.value.match(o)?t.isValid=!0:(t.isValid=!1,t.bottomMessage="\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u0444\u043e\u0440\u043c\u0430\u0442\u0430")}}a[n]=Object(d.a)({},t)})),this.setState({formQuery:t}),e}},{key:"render",value:function(){var e=this,t=this.state,a=t.formQuery,n=t.actionText,s=this.props,i=s.id,o=s.hashParams,c=a.fields||[];return r.a.createElement(y.s,{id:i},r.a.createElement(_,{hashParams:o}),r.a.createElement(y.k,null,c.map((function(t){return e.renderRow(t)})),r.a.createElement(y.b,{size:"xl",onClick:this.submitForm},n)))}}]),a}(r.a.Component),Z=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).wallPost=function(){var t=e.props.hashParams;if(c.a.supports("VKWebAppShowWallPostBox")){var a={};t.get("message")&&(a.message=t.get("message")),t.get("friends_only")&&(a.friends_only=Number(1===Number(t.get("friends_only")))),t.get("attachments")&&(a.attachments=t.get("attachments")),t.get("signed")&&(a.signed=Number(1===Number(t.get("signed")))),t.get("publish_date")&&(a.publish_date=Number(t.get("publish_date"))),t.get("mark_as_ads")&&(a.mark_as_ads=Number(1===Number(t.get("mark_as_ads")))),t.get("close_comments")&&(a.close_comments=Number(1===Number(t.get("close_comments")))),c.a.send("VKWebAppShowWallPostBox",a).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",t)}))}else e.props.sendError("\u041f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.wallPost,hashParams:a,actionText:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c",requests:"\u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u043d\u0430 \u0412\u0430\u0448\u0435\u0439 \u0441\u0442\u0435\u043d\u0435"}))}}]),a}(r.a.Component),$=a(122),ee=a.n($),te=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).saveScrolls=function(e){n.scrolls[n.state.page]=window.pageYOffset,window.pageYOffset>320&&!n.state.showScrollToTop?n.setState({showScrollToTop:!0}):n.state.showScrollToTop&&window.pageYOffset<=320&&n.setState({showScrollToTop:!1})},n.selectCountry=function(e,t){var a=n.props.activeHash;"selectCountry"===a?n.props.sendResponse({country_id:e,country_title:t}):(n.nextPage(),n.backActions.push("selectRegion"===a?n.clearRegions:n.clearCities),n.setState({selectedCountryId:e,searchQuery:"",countryName:t,page:"cities"},(function(){"selectRegion"===a?n.loadRegions():n.loadCities()})))},n.goBack=function(){console.log("back"),window.history.back()},n.selectCity=function(){var e=Object(h.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"selectCity"===(a=n.props.activeHash)?n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,city_id:t.id,city_title:t.title}):(n.nextPage(),n.backActions.push("selectSchool"===a?n.clearSchool:"selectMetroStation"===a?n.clearMetroStation:n.clearUniversity),n.setState({selectedCityId:t.id,searchQuery:"",cityName:t.title,page:"selectSchool"===a?"schools":"selectMetroStation"===a?"metro_stations":"universities"},(function(){"selectSchool"===a?n.loadSchools():"selectMetroStation"===a?n.loadMetroStations():n.loadUniversities()})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.selectRegion=function(){var e=Object(h.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.props.activeHash,n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,region_id:t.id,region_title:t.title});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.selectChair=function(){var e=Object(h.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.props.sendResponse({chair_id:t.id,chair_title:t.title,city_id:n.state.selectedCityId||0,city_title:n.state.cityName||"",country_id:n.state.selectedCountryId||0,country_title:n.state.countryName||"",university_id:n.state.selectedUniversityId||0,university_title:n.state.universityName||"",faculty_id:n.state.selectedFacultyId||0,faculty_title:n.state.facultyName||""});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.clearCities=function(){n.props.hashParams.get("country_id")&&!n.state.countries.length&&n.loadCountries(),n.scrolls.cities=0,n.setState({cities:[],selectedCountryId:0,countryName:"",searchQuery:"",page:"countries"})},n.clearRegions=function(){n.props.hashParams.get("country_id")&&!n.state.countries.length&&n.loadCountries(),n.scrolls.regions=0,n.setState({regions:[],selectedCountryId:0,countryName:"",searchQuery:""})},n.changeSearchQuery=function(e){var t=e.target.value,a=n.props.activeHash;clearTimeout(n.searchTimeout),n.searchTimeout=setTimeout((function(){n.scrolls[n.state.page]=0,n.setState({searchQuery:String(t).toLocaleLowerCase()}),!n.state.selectedCountryId||n.state.selectedCityId||n.state.selectedUniversityId?!n.state.selectedCityId||n.state.selectedUniversityId||n.state.selectedSchoolId||("selectSchool"===a?n.loadSchools(t):"selectMetroStation"!==a&&n.loadUniversities(t)):"selectRegion"===a?n.loadRegions(t):n.loadCities(t)}),400)},n.clearUniversity=function(){var e=n.props.hashParams;n.scrolls.universities=0,n.setState({selectedCityId:0,unversities:[],loadedUniversities:!1,selectedUniversityId:0,searchQuery:"",page:"cities"},(function(){e.get("city_id")&&n.loadCountries()}))},n.clearMetroStation=function(){var e=n.props.hashParams;n.scrolls.metro_stations=0,n.setState({selectedCityId:0,unversities:[],loadedUniversities:!1,selectedUniversityId:0,searchQuery:"",page:"cities",loadedMetroStations:!1,selectedMetroStationId:0,metroStations:[]},(function(){e.get("city_id")&&n.loadCountries()}))},n.clearSchool=function(){var e=n.props.hashParams;n.scrolls.schools=0,n.setState({selectedCityId:0,schools:[],loadedSchools:!1,selectedSchoolId:0,searchQuery:""},(function(){e.get("city_id")&&n.loadCountries()}))},n.clearFaculty=function(){var e=n.props.hashParams;n.scrolls.faculties=0,n.setState({selectedUniversityId:0,faculties:[],loadedFaculties:!1,searchQuery:"",page:"universities"},(function(){e.get("university_id")&&n.loadCountries()}))},n.clearChair=function(){var e=n.props.hashParams;n.scrolls.chairs=0,n.setState({selectedFacultyId:0,chairs:[],loadedChairs:!1,searchQuery:"",page:"faculties"},(function(){e.get("faculty_id")&&n.loadCountries()}))},n.selectUniversity=function(e,t){"selectUniversity"===n.props.activeHash?n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,city_id:n.state.selectedCityId,city_title:n.state.cityName,university_id:e,university_title:t}):(n.nextPage(),n.backActions.push(n.clearFaculty),n.setState({selectedUniversityId:e,searchQuery:"",universityName:t,page:"faculties"},(function(){n.loadFaculties()})))},n.selectSchool=function(e,t){n.props.activeHash;n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,city_id:n.state.selectedCityId,city_title:n.state.cityName,school_id:e,school_title:t})},n.selectMetroStation=function(e,t){n.props.activeHash;n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,city_id:n.state.selectedCityId,city_title:n.state.cityName,station_id:e,station_title:t})},n.selectFaculty=function(e,t){"selectFaculty"===n.props.activeHash?n.props.sendResponse({country_id:n.state.selectedCountryId,country_title:n.state.countryName,city_id:n.state.selectedCityId,city_title:n.state.cityName,university_id:n.state.selectedUniversityId,university_title:n.state.universityName,faculty_id:e,faculty_title:t}):(n.nextPage(),n.backActions.push(n.clearChair),n.setState({selectedFacultyId:e,searchQuery:"",facultyName:t,page:"chairs"},(function(){n.loadChairs()})))},n.renderPage=function(){var e=n.state,t=e.countries,a=e.cities,s=e.unversities,i=e.faculties,o=e.chairs,c=e.schools,l=e.regions,u=e.metroStations,d=e.countryName,h=e.cityName,p=(e.universityName,e.chairName,e.regionName,e.metroStationName,e.selectedCountryId),m=e.selectedCityId,f=e.selectedUniversityId,v=e.selectedFacultyId,g=e.selectedChairId,b=e.selectedSchoolId,k=e.selectedRegionId,_=e.selectedMetroStationId,C=e.loadedCountries,E=e.loadedCities,w=e.loadedUniversities,S=e.loadedFaculties,x=e.loadedChairs,P=e.loadedSchools,A=e.loadedRegions,O=e.loadedMetroStations,j=(e.searchQuery,n.props),I=j.hashParams,R=j.activeHash;return C&&!t.length&&null==I.get("country_id")||null!=I.get("country_id")&&!d&&C&&p&&!t.length||E&&!a.length&&null==I.get("city_id")&&p||null!=I.get("city_id")&&!h&&E&&!a.length||w&&!s.length&&null==I.get("university_id")&&-1===["selectSchool","selectMetroStation"].indexOf(R)||S&&!i.length&&null==I.get("faculty_id")||x&&!o.length?p||m||f||v?m||f||v?f||v?v?n.renderChairs():n.renderFaculties():"selectSchool"===R?n.renderSchools():"selectMetroStation"===R?n.renderMetroStations():n.renderUniversities():"selectRegion"===R?n.renderRegions():n.renderCities():n.renderCountries():(C||p||t.length||m||k||f||v)&&(E||m||a.length||!p||f||v||"selectRegion"===R)&&(A||k||l.length||!p||f||v||"selectRegion"!==R)&&(w||f||s.length||!m||v||-1!==["selectSchool","selectMetroStation"].indexOf(R))&&(S||v||i.length||!f)&&(P||b||c.length||!m||"selectSchool"!==R)&&(O||_||u.length||!m||"selectMetroStation"!==R)&&(x||g||o.length||!v)?p||m||f||v?(m||f||v||"selectRegion"===R)&&(k||f||v||"selectRegion"!==R)?!f&&!v&&"selectSchool"!==R||!b&&!v&&"selectSchool"===R?"selectSchool"===R?n.renderSchools():"selectMetroStation"===R?n.renderMetroStations():n.renderUniversities():v?g?void 0:n.renderChairs():n.renderFaculties():"selectRegion"===R?n.renderRegions():n.renderCities():n.renderCountries():r.a.createElement(y.u,{size:"l"})};var s=e.hashParams.get("method");return n.isEducationMethod=-1!==["selectFaculty","selectUniversity","selectChair","selectSchool","selectMetroStation"].indexOf(s),n.state={countries:[],cities:[],unversities:[],faculties:[],chairs:[],schools:[],regions:[],metroStations:[],selectedCountryId:0,selectedCityId:0,selectedFacultyId:0,selectedUniversityId:0,selectedChairId:0,selectedSchoolId:0,selectedRegionId:0,selectedMetroStationId:0,loadedCountries:!1,loadedCities:!1,loadedUniversities:!1,loadedFaculties:!1,loadedChairs:!1,loadedSchools:!1,loadedRegions:!1,loadedMetroStations:!1,countryName:"",cityName:"",universityName:"",facultyName:"",chairName:"",schoolName:"",regionName:"",metroStationName:"",searchQuery:"",page:"countries",showScrollToTop:!1},n.scrolls={countries:0,cities:0,regions:0,unversities:0,faculties:0,chairs:0,metro_stations:0,schools:0},n.backActions=[],n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.isEducationMethod,a=this.props,n=a.hashParams,r=a.activeHash;n.get("country_id")?"selectRegion"===r?this.goToRegions():this.goToCities():n.get("city_id")&&t?"selectSchool"===r?this.goToSchools():"selectMetroStation"===r?this.goToMetroStations():this.goToUniversities():n.get("university_id")&&t?this.goToFaculties():n.get("faculty_id")&&t?this.goToChairs():this.state.countries.length||this.loadCountries(),window.onpopstate=function(t){if(console.log(t),"popstate"===t.type&&(console.log(e.backActions),e.backActions.length&&e.backActions[e.backActions.length-1])){try{e.backActions[e.backActions.length-1]()}catch(t){console.error(t)}e.backActions=e.backActions.slice(0,e.backActions.length-1)}},window.addEventListener("scroll",this.saveScrolls)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.saveScrolls)}},{key:"componentDidUpdate",value:function(){window.scrolling||window.scrollTo(0,this.scrolls[this.state.page])}},{key:"goToCities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCountriesById",{country_ids:Number(a.get("country_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCountryId:r.id,countryName:r.title,loadedCountries:!0,page:"cities"},(function(){s.loadCities()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToRegions",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCountriesById",{country_ids:Number(a.get("country_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCountryId:r.id,countryName:r.title,loadedCountries:!0},(function(){s.loadRegions()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToUniversities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCitiesById",{city_ids:Number(a.get("city_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCityId:r.id,cityName:r.title,loadedCities:!0},(function(){s.loadUniversities()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToSchools",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCitiesById",{city_ids:Number(a.get("city_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCityId:r.id,cityName:r.title,loadedCities:!0},(function(){s.loadSchools()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToMetroStations",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.hashParams,n=t.vkApi,e.next=3,n("database.getCitiesById",{city_ids:Number(a.get("city_id"))});case 3:r=(r=e.sent)[0],this.setState({selectedCityId:r.id,cityName:r.title,loadedCities:!0},(function(){s.loadMetroStations()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToFaculties",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,a=t.hashParams,t.vkApi,this.setState({selectedUniversityId:Number(a.get("university_id")),loadedUniversities:!0},(function(){n.loadFaculties()}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goToChairs",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,a=t.hashParams,t.vkApi,this.setState({selectedFacultyId:Number(a.get("faculty_id")),loadedFaculties:!0},(function(){n.loadChairs()}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCountries",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedCountries:!1}),e.next=4,this.props.vkApi("database.getCountries",{need_all:1,q:t,count:1e3});case 4:a=e.sent,this.setState({loadedCountries:!0,countries:a.items});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedCities:!1}),e.next=4,this.props.vkApi("database.getCities",{country_id:this.state.selectedCountryId,q:t});case 4:a=e.sent,this.setState({loadedCities:!0,cities:a.items});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadRegions",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedRegions:!1}),e.next=4,this.props.vkApi("database.getRegions",{country_id:this.state.selectedCountryId,q:t});case 4:a=e.sent,this.setState({loadedRegions:!0,regions:a.items,page:"regions"});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextPage",value:function(){window.history.pushState(null,null)}},{key:"loadUniversities",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedUniversities:!1}),e.next=4,this.props.vkApi("database.getUniversities",{city_id:this.state.selectedCityId,q:t});case 4:a=e.sent,this.setState({loadedUniversities:!0,unversities:a.items,page:"universities"});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadSchools",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedSchools:!1}),e.next=4,this.props.vkApi("database.getSchools",{city_id:this.state.selectedCityId,q:t});case 4:a=e.sent,this.setState({loadedSchools:!0,schools:a.items,page:"schools"});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadMetroStations",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loadedMetroStations:!1}),e.next=3,this.props.vkApi("database.getMetroStations",{city_id:this.state.selectedCityId,count:500});case 3:t=e.sent,this.setState({loadedMetroStations:!0,metroStations:t.items,page:"metro_stations"});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderCities",value:function(){var e=this,t=this.state,a=t.cities,n=(t.loadedCities,t.searchQuery,"no"!==this.props.hashParams.get("can_change_country"));return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:n?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0443"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043e\u0440\u043e\u0434 ",this.getTargetName())},r.a.createElement(y.r,null,a.map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectCity(t)},key:"city"+t.id},t.title)})),a.length?null:r.a.createElement(y.h,null,"\u0413\u043e\u0440\u043e\u0434\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b")))}},{key:"renderRegions",value:function(){var e=this,t=this.state,a=t.regions,n=(t.searchQuery,"no"!==this.props.hashParams.get("can_change_country"));return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:n?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0443"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0433\u0438\u043e\u043d")},r.a.createElement(y.r,null,a.map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectRegion(t)},key:"region"+t.id},t.title)})),a.length?null:r.a.createElement(y.h,null,"\u0420\u0435\u0433\u0438\u043e\u043d\u043e\u0432 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"getTargetName",value:function(){var e=this.props.activeHash;return this.isEducationMethod?"selectSchool"===e?"\u0448\u043a\u043e\u043b\u044b":"selectMetroStation"===e?"":"\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0430":""}},{key:"renderCountries",value:function(){var e=this,t=this.state,a=t.countries,n=t.searchQuery;return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary"},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0443 ",this.getTargetName())},r.a.createElement(y.r,null,a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectCountry(t.id,t.title)},key:"country"+t.id},t.title)})),a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).length?null:r.a.createElement(y.h,null,"\u0421\u0442\u0440\u0430\u043d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"loadFaculties",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",this.setState({loadedFaculties:!1}),e.next=4,this.props.vkApi("database.getFaculties",{university_id:this.state.selectedUniversityId,q:t,count:1e4});case 4:a=e.sent,this.setState({loadedFaculties:!0,faculties:a.items,page:"faculties"});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadChairs",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loadedChairs:!1}),e.next=3,this.props.vkApi("database.getChairs",{faculty_id:this.state.selectedFacultyId,count:1e4});case 3:t=e.sent,this.setState({loadedChairs:!0,chairs:t.items,page:"chairs"});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderUniversities",value:function(){var e=this,t=this.state,a=t.unversities,n=t.searchQuery,s=this.props.hashParams;return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:"no"!=s.get("can_change_city")?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0433\u043e\u0440\u043e\u0434"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442")},r.a.createElement(y.r,null,a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectUniversity(t.id,t.title)},key:"unversity"+t.id},t.title)})),a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).length?null:r.a.createElement(y.h,null,"\u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u043e\u0432 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"renderSchools",value:function(){var e=this,t=this.state,a=t.schools,n=(t.searchQuery,this.props.hashParams);return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:"no"!=n.get("can_change_city")?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.clearSchool},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0433\u043e\u0440\u043e\u0434"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0448\u043a\u043e\u043b\u0443")},r.a.createElement(y.r,null,a.map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectSchool(t.id,t.title)},key:"school"+t.id},t.title)})),a.length?null:r.a.createElement(y.h,null,"\u0428\u043a\u043e\u043b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"renderMetroStations",value:function(){var e=this,t=this.state,a=t.metroStations,n=t.searchQuery,s=this.props.hashParams;return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:"no"!=s.get("can_change_city")?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0433\u043e\u0440\u043e\u0434"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u043d\u0446\u0438\u044e")},r.a.createElement(y.r,null,a.filter((function(e){return String(e.name).toLocaleLowerCase().match(n)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectMetroStation(t.id,t.name)},key:"station"+t.id},t.name)})),a.filter((function(e){return String(e.name).toLocaleLowerCase().match(n)})).length?null:r.a.createElement(y.h,null,"\u0421\u0442\u0430\u043d\u0446\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"renderFaculties",value:function(){var e=this,t=this.state,a=t.faculties,n=t.searchQuery,s=this.props.hashParams;return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:"no"!==s.get("can_change_university")?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u043a\u0443\u043b\u044c\u0442\u0435\u0442")},r.a.createElement(y.r,null,a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectFaculty(t.id,t.title)},key:"faculty"+t.id},t.title)})),a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).length?null:r.a.createElement(y.h,null,"\u0424\u0430\u043a\u0443\u043b\u044c\u0442\u0435\u0442\u043e\u0432 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"renderChairs",value:function(){var e=this,t=this.state,a=t.chairs,n=t.searchQuery,s=this.props.hashParams;return r.a.createElement(y.n,{header:r.a.createElement(y.o,{mode:"secondary",aside:"no"!==s.get("can_change_faculty")?r.a.createElement(y.b,{className:"btn-15",mode:"tertiary",onClick:this.goBack},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0430\u043a\u0443\u043b\u044c\u0442\u0435\u0442"):null},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u0444\u0435\u0434\u0440\u0443")},r.a.createElement(y.r,null,a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).map((function(t){return r.a.createElement(y.e,{onClick:function(){return e.selectChair(t)},key:"chair"+t.id},t.title)})),a.filter((function(e){return String(e.title).toLocaleLowerCase().match(n)})).length?null:r.a.createElement(y.h,null,"\u041a\u0430\u0444\u0435\u0434\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")))}},{key:"render",value:function(){var e=this.state,t=(e.countries,e.cities,e.countryName,e.cityName,e.selectedCountryId),a=e.selectedCityId,n=e.selectedUniversityId,s=e.selectedFacultyId,i=e.selectedChairId,o=this.props.hashParams,c=(o.get("country_id"),"");return c=!t||a||n||i?!a||n||i?n&&!s?"faculty":s?"chair":"country":"university":"city",r.a.createElement(y.s,{id:this.props.id},r.a.createElement(_,{hashParams:o,setSearch:!0,key:c,onChange:this.changeSearchQuery}),this.renderPage(),r.a.createElement(y.i,{vertical:"bottom"},this.state.showScrollToTop?r.a.createElement(y.b,{onClick:function(){return b()},className:"scroll-to-top-button"},r.a.createElement(ee.a,null)):null))}}]),a}(r.a.Component),ae=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).showStoryBox=function(){var t=e.props.hashParams;if(c.a.supports("VKWebAppShowStoryBox")){var a=t.get("background_type")||"none",n=t.get("url"),r=t.get("blob"),s=1===Number(t.get("locked")),i=t.get("attachment"),o=t.getAll("stickers"),l={};if(a&&(l.background_type=a),n&&(l.url=n),r&&(l.blob=r),o.forEach((function(e,t){try{e=JSON.parse(decodeURIComponent(e))}catch(a){e={}}o[t]=e})),o.length&&(l.stickers=o),i)try{i=JSON.parse(i),l.attachment=i}catch(u){l.attachment={}}l.locked=s,c.a.send("VKWebAppShowStoryBox",l).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e",t)}))}else e.props.sendError("\u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440 \u0438\u0441\u0442\u043e\u0440\u0438\u0439 \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.showStoryBox,hashParams:a,requests:"\u041f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0435\u0442 \u0412\u0430\u043c \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e",actionText:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c"}))}}]),a}(r.a.Component),ne=a(123),re=a.n(ne),se=a(124),ie=a.n(se),oe=a(125),ce=a.n(oe),le=a(126),ue=a.n(le),de=a(127),he=a.n(de),pe=a(59),me=a(128),fe=a.n(me),ve=a(129),ye=a.n(ve),ge=a(61),be=(a(285),function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).loadMore=Object(h.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.nextPageUrl){e.next=5;break}if(n.loading){e.next=3;break}return e.abrupt("return",n.fetchMore());case 3:e.next=7;break;case 5:return n.setState({hasMore:!1}),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)}))),n.makeSearch=function(e){window.scrolling||b(),n.list.options.enable_server_search&&n.fetchMore(e.target.value,!0),n.setState({searchQuery:e.target.value})},n.sendSelectedItems=function(){return n.sendResponse({selected_item_ids:n.state.selectedItemIds})},n.selectItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.id){var t=Object(J.a)(n.state.selectedItemIds);n.isSelectedItem(e)?t.splice(t.indexOf(e.id),1):t.push(e.id),n.setState({selectedItemIds:t})}};var r=e.hashParams.get("list");r.options||(r.options={});var s=r.items;return n.list=r,n.itemsGalleries={},n.state={items:s,hasMore:!!r.options.load_more_url,nextPageUrl:n.list.options.load_more_url||"",enableSearch:Boolean(n.list.options.enable_search),searchQuery:"",cardSize:0,windowWidth:window.innerWidth,selectedItemIds:[]},n.loading=!1,n}return Object(m.a)(a,[{key:"fetchMore",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.loading=!0;var n=this.props.hashParams,r=t&&a?n.get("launch_options"):this.state.nextPageUrl,s=this.state.searchQuery,i=new URL(r),o={q:t||s};return Object.keys(o).forEach((function(e){return i.searchParams.append(e,o[e])})),Object(pe.a)(i).then(function(){var n=Object(h.a)(u.a.mark((function n(r){var s,i,o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.json();case 2:r=n.sent,s=t&&a?r.list.items||[]:r.items||[],i=!(!t||!a)||Boolean(r.has_more),o=t&&a?r.list.options.load_more_url:r.next_page_url||"",e.setState({items:[].concat(Object(J.a)(e.state.items),Object(J.a)(s)),hasMore:i,nextPageUrl:o}),e.loading=!1;case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(t){e.setState({hasMore:!1}),e.loading=!1}))}},{key:"componentDidMount",value:function(){var e=this,t=document.querySelector(".card");t&&this.setState({cardSize:t.offsetWidth}),window.onresize=function(){var t=document.querySelector(".card"),a=window.innerWidth;(a<=400&&e.state.windowWidth>400||a>400&&e.state.windowWidth<=400)&&(e.updateCardWidth=!0),t&&e.setState({cardSize:t.offsetWidth,windowWidth:a})}}},{key:"componentDidUpdate",value:function(){if(this.updateCardWidth){var e=document.querySelector(".card");this.updateCardWidth=!1,e&&this.setState({cardSize:e.offsetWidth})}}},{key:"componentWillUnmount",value:function(){window.onresize=null}},{key:"renderIcon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e){case"market":return r.a.createElement(ie.a,null);default:return null}}},{key:"renderActionIcon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e){case"done":return r.a.createElement(ue.a,null);case"market":return r.a.createElement(he.a,null);default:return null}}},{key:"sendClick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.sendResponse({button_payload:t,selected_item_id:e})}},{key:"sendResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.props.sendResponse(Object(d.a)({},e,{list_type:this.list.type,list_name:this.list.name||""}))}},{key:"renderButtons",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,n=t.buttons||[];n.length||(n=this.list.options.buttons||[]);var s=this.state.windowWidth;return r.a.createElement("div",{className:"buttons"},n.map((function(n,i){var o="button_"+i+"_"+a,c=s>400&&s<600?"m":"xl",l=e.isSelectedItem(t);if(!n.action||!n.action.type)return null;var u=n.action.selected_state&&n.action.selected_state.color?n.action.selected_state.color:n.color,d=n.action.selected_state&&n.action.selected_state.label?n.action.selected_state.label:n.action.label,h=n.action.selected_state&&n.action.selected_state.icon?n.action.selected_state.icon:n.icon;switch(n.action.type){case"text":return r.a.createElement("div",{className:"button-wrap",key:o},r.a.createElement(y.b,{before:e.renderActionIcon(n.icon),size:c,onClick:function(){return n.action.payload?e.sendClick(t.id,n.action.payload):null},stretched:!0,mode:n.color||"primary"},n.action.label));case"open_link":return r.a.createElement("div",{className:"button-wrap",key:o},r.a.createElement(y.q,{rel:"noreferrer noopener",href:n.action.link||"",target:"_blank"},r.a.createElement(y.b,{before:e.renderActionIcon(n.icon),size:c,stretched:!0,mode:n.color||"primary"},n.action.label)));case"select":return e.list.options.enable_select?r.a.createElement("div",{className:"button-wrap",key:o},r.a.createElement(y.b,{before:l&&h?e.renderActionIcon(h):e.renderActionIcon(n.icon),onClick:function(){return e.selectItem(t)},size:c,stretched:!0,mode:l?u:n.color||"primary"},l?d:n.action.label)):null}})))}},{key:"getButtons",value:function(e){return e.buttons&&e.buttons.length?e.buttons:this.list.options.buttons||[]}},{key:"isSelectedItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e.id&&-1!==this.state.selectedItemIds.indexOf(e.id)}},{key:"render",value:function(){var e=this,t=this.props,a=t.id,n=t.hashParams,s=this.state,i=s.items,o=s.hasMore,l=this.state.searchQuery.toLocaleLowerCase();if(!this.list.options.enable_server_search){var u=i.filter((function(t,a){return!!e.list.options.enable_server_search||(t.__key=a,-1!==String(t.title).toLocaleLowerCase().indexOf(l))})),d=i.filter((function(e,t){return e.__key=t,-1!==String(e.description).toLocaleLowerCase().indexOf(l)}));i=Object(J.a)(u),d.forEach((function(e){u.find((function(t){return t.__key===e.__key}))||i.push(e)}))}var h=this.list.type,p=null,m=this.state,f=m.cardSize,v=m.windowWidth,g=m.selectedItemIds,b=this.list.options.aspect_ratio?this.list.options.aspect_ratio.split(":"):"";b.length||(b=[13,8]);var k={height:f*b[1]/b[0]||"auto"};if(i.length)switch(h){case"vk_entities":p=i.map((function(t,a){return r.a.createElement(y.e,{before:t.avatar_src?r.a.createElement(y.a,{size:e.list.options.avatar_size||48,src:t.avatar_src}):null,description:t.description,multiline:e.list.options.multiline,href:t.link,target:"_blank",rel:"noreferrer noopener",key:"cell-item"+a},t.title)}));break;case"cards":var C=[];i.forEach((function(e,t){var a=[];(t+1)%2===1&&(a.push(i[t]),i[t+1]?a.push(i[t+1]):a.push(null)),a.length&&C.push(a)}));var E=v>400?"m":"l";p=r.a.createElement(ge.Grid,{fluid:!0},r.a.createElement(ge.Row,null,i.map((function(t,a){if(t){var n=e.getButtons(t).find((function(e){return e.action&&"select"===e.action.type})),s={initialIndex:e.itemsGalleries[t.id]||0,pageDots:!1,prevNextButtons:!1,fullscreen:!0,adaptiveHeight:!0,wrapAround:!0};return r.a.createElement(ge.Col,{xs:12,md:3,key:"card"+a+"_"+t.id},r.a.createElement(y.c,{mode:"shadow",className:"card",size:E},t.images&&Array.isArray(t.images)?r.a.createElement("div",null,e.list.options.enable_select&&!n?r.a.createElement(y.f,{defaultChecked:e.isSelectedItem(t),onChange:function(){return e.selectItem(t)},className:"card--checkbox"}):null,r.a.createElement(re.a,{flickityRef:function(a){a.on("settle",(function(){return e.itemsGalleries[t.id]=a.selectedIndex}))},options:s,onClick:function(){return c.a.send("VKWebAppShowImages",{images:t.images,start_index:e.itemsGalleries[t.id]||0})}},t.images.map((function(e){return r.a.createElement("div",{className:"slide-wrap"},r.a.createElement("img",{style:k,src:e,alt:"\u0421\u043b\u0430\u0439\u0434"}))})))):null,r.a.createElement(y.h,{className:"card--footer"},r.a.createElement("div",{className:"card--footer-title"},t.title?r.a.createElement("b",null,t.title):null,t.description?r.a.createElement("span",{className:"card--description"},r.a.createElement("span",{className:"description"},t.description)):null),e.renderButtons(t,a+"_"))))}return r.a.createElement("div",{className:"card"})}))))}else p=r.a.createElement(y.j,null,l?this.list.options.empty_search_error_text?this.list.options.empty_search_error_text:"\u041f\u043e\u0438\u0441\u043a \u043d\u0435 \u0434\u0430\u043b \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432":this.list.options.empty_error_text?this.list.options.empty_error_text:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442");return r.a.createElement(y.s,{id:a},r.a.createElement(_,{hashParams:n,after:this.state.enableSearch?r.a.createElement(y.i,{vertical:"top"},r.a.createElement(y.x,{onChange:this.makeSearch})):null}),r.a.createElement(ye.a,{pageStart:0,hasMore:o,loader:r.a.createElement("div",{style:{marginTop:24}},r.a.createElement(y.z,null)),loadMore:this.loadMore,threshold:10},r.a.createElement("div",{className:fe()("content-page",{search:this.state.enableSearch})},p)),this.list.options.enable_select?r.a.createElement(y.i,{vertical:"bottom"},r.a.createElement("div",{className:"bottom-list-actions"},r.a.createElement("div",{className:"bottom-list-actions--items"},r.a.createElement(y.h,null,r.a.createElement(y.b,{size:"l",stretched:!0,after:r.a.createElement(y.g,null,g.length),mode:"secondary"},r.a.createElement(ce.a,null))),r.a.createElement(y.h,{className:"primary-action"},r.a.createElement(y.b,{disabled:0===g.length,size:"l",onClick:this.sendSelectedItems,stretched:!0,before:this.renderIcon(this.list.options.complete_action_icon)},this.list.options.complete_action_text?this.list.options.complete_action_text:"\u0413\u043e\u0442\u043e\u0432\u043e"))))):null)}}]),a}(r.a.Component)),ke=(a(286),function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){window.DG.then((function(){window.DG.map("map",{center:[54.98,82.89],zoom:13})}))}},{key:"render",value:function(){var e=this.props.hashParams;return r.a.createElement(y.s,{id:this.props.id},r.a.createElement(_,{hashParams:e}),r.a.createElement("div",{id:"map",className:"two-gis-map-container"}))}}]),a}(r.a.Component)),_e=function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).getInfo=function(){c.a.supports("VKWebAppGetUserInfo")?c.a.send("VKWebAppGetUserInfo",{}).then((function(t){e.props.sendResponse(t)})).catch((function(t){e.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435",t)})):e.props.sendError("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435l \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e",{error_code:"not_supports"})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.getInfo,hashParams:a,requests:"\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043e\u0431\u0449\u0435\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0412\u0430\u0441"}))}}]),a}(r.a.Component),Ce=(a(287),function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).getEmail=function(){c.a.supports("VKWebAppGetUserInfo")?c.a.send("VKWebAppGetUserInfo",{}).then((function(e){n.props.sendResponse(e)})).catch((function(e){n.props.sendError("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435",e)})):n.props.sendError("\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435l \u043d\u0430 \u044d\u0442\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e",{error_code:"not_supports"})},n.getData=Object(h.a)(u.a.mark((function e(){var t,a,r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},a=Object(H.a)(n.scope),e.prev=2,a.s();case 4:if((r=a.n()).done){e.next=15;break}if(s=r.value,!n.state.scopeSelected[s]){e.next=12;break}return e.next=9,n.getDataField(s);case 9:t[s]=e.sent,e.next=13;break;case 12:t[s]={error:!0,error_message:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u043b \u044d\u0442\u043e \u043f\u043e\u043b\u0435",error_code:"user_canceled"};case 13:e.next=4;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),a.e(e.t0);case 20:return e.prev=20,a.f(),e.finish(20);case 23:n.props.sendResponse(t);case 24:case"end":return e.stop()}}),e,null,[[2,17,20,23]])}))),n.scope=k(e.hashParams.get("scope")||""),"all"===e.hashParams.get("scope")&&(n.scope=["info","phone","email"]),n.disabled=k(e.hashParams.get("disabled")||"").filter((function(e){return"all"!==e})),n.disabledAll="all"===e.hashParams.get("disabled"),n.state={scopeSelected:{phone:!0,email:!0,info:!0},loading:!1},n.useToken=1===Number(n.props.hashParams.get("use_token")),n.dataFields=n.props.hashParams.get("info_fields")||"photo_200",n.fieldsTypes={minimal:"bdate,city,country,verified,nickname",personal:"personal,interests,music,books,tx,movies,games,quotes,about,status,education,universities,schools,career,military",photos:"photo_50,photo_100,photo_200_orig,photo_200,photo_400_orig,photo_max,photo_max_orig"},"minimal"===n.dataFields?n.dataFields=n.fieldsTypes.minimal:"minimal_and_photos"===n.dataFields?n.dataFields=n.fieldsTypes.minimal+","+n.fieldsTypes.photos:"personal"===n.dataFields?n.dataFields=n.fieldsTypes.personal:"minimal_and_personal"===n.dataFields?n.dataFields=n.fieldsTypes.minimal+","+n.fieldsTypes.personal:"photos"===n.dataFields?n.dataFields=n.fieldsTypes.photos:"all"===n.dataFields&&(n.dataFields=n.fieldsTypes.minimal+","+n.fieldsTypes.photos+","+n.fieldsTypes.personal),n}return Object(m.a)(a,[{key:"renderRequestsContent",value:function(){var e=this;return this.scope.length?this.scope.map((function(t,a){return r.a.createElement(y.f,{key:"permission-"+a,onChange:function(a){e.setState({scopeSelected:Object(d.a)({},e.state.scopeSelected,Object(g.a)({},t,a.target.checked))})},disabled:e.disabledAll||-1!==e.disabled.indexOf(t),className:"checkkox-mini",defaultChecked:!0},e.getPermissionTitle(t))})):r.a.createElement(y.h,{className:"align-center"},r.a.createElement("span",{className:"description"},"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 scope \u043d\u0435 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d"))}},{key:"getPermissionTitle",value:function(e){switch(e){case"email":return"\u0414\u043e\u0441\u0442\u0443\u043f \u043a email";case"phone":return"\u0414\u043e\u0441\u0442\u0443\u043f \u043a \u043d\u043e\u043c\u0435\u0440\u0443 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430";case"info":return"\u0414\u043e\u0441\u0442\u0443\u043f \u043a \u043e\u0431\u0449\u0435\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438";default:return null}}},{key:"getDataField",value:function(){var e=Object(h.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="email"===e.t0?3:"phone"===e.t0?4:"info"===e.t0?5:15;break;case 3:return e.abrupt("return",this.makeApiDataRequest("VKWebAppGetEmail","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c email").then((function(e){return e.email&&(e={email:e.email}),e})));case 4:return e.abrupt("return",this.makeApiDataRequest("VKWebAppGetPhoneNumber","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430").then((function(e){return e.phone_number&&(e={phone_number:e.phone_number}),e})));case 5:if(!this.useToken){e.next=14;break}if(!this.props.userToken){e.next=10;break}return e.abrupt("return",this.getUserInfoByToken(this.props.userToken));case 10:return e.next=12,this.props.onRequestToken();case 12:return a=e.sent,e.abrupt("return",this.getUserInfoByToken(a));case 14:return e.abrupt("return",this.makeApiDataRequest("VKWebAppGetUserInfo","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserInfoByToken",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a=this,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:""){e.next=3;break}return e.abrupt("return",{error:!0,error_code:"invalid_token"});case 3:return console.log(this.dataFields),this.setState({loading:!0}),e.abrupt("return",this.props.vkApi("users.get",{access_token:t,fields:this.dataFields}).then((function(e){return e[0]})).catch((function(e){return Object(d.a)({error:!0},e)})).then((function(e){return a.setState({loading:!1}),e})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeApiDataRequest",value:function(){var e=Object(h.a)(u.a.mark((function e(t){var a,n,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.length>1&&void 0!==r[1]?r[1]:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043c\u0435\u0442\u043e\u0434",n=r.length>2&&void 0!==r[2]?r[2]:{},!c.a.supports(t)){e.next=6;break}return e.abrupt("return",c.a.send(t,n).then((function(e){return e})).catch((function(e){return Object(d.a)({error:!0,error_message:a},e)})));case 6:return e.abrupt("return",{error:!0,error_message:"\u041c\u0435\u0442\u043e\u0434 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d",error_code:"not_supports"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.id,a=e.hashParams;return r.a.createElement(y.s,{id:t,centered:!0},r.a.createElement(_,{hashParams:a}),r.a.createElement(N,{onClick:this.getData,hashParams:a,content:this.renderRequestsContent(),requests:"\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c",hideButton:!this.scope.length,showSpinner:this.state.loading}))}}]),a}(r.a.Component)),Ee=(a(288),function(e){Object(v.a)(a,e);var t=Object(f.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).sendResponse=Object(h.a)(u.a.mark((function e(){var t,a,r,s,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},a=!(i.length>1&&void 0!==i[1])||i[1],(r=Object(d.a)({method:n.state.activeHash,hash:window.location.hash.replace("#","")},t)).error||(r.success=!0),!(s=n.hashParams.get("bot_id"))){e.next=8;break}return e.next=8,c.a.send("VKWebAppSendPayload",{group_id:Number(s),payload:r});case 8:if(!a){e.next=17;break}if(n.wasClosed=!0,"desktop_web"!==n.queryParams.get("vk_platform")&&"mobile_web"!==n.queryParams.get("vk_platform")){e.next=14;break}window.history.back(),e.next=17;break;case 14:return c.a.send("VKWebAppSetLocation",{location:window.location.hash+"&"+(new Date).getTime()}),e.next=17,c.a.send("VKWebAppClose",{status:"success",payload:r});case 17:case"end":return e.stop()}}),e)}))),n.sendError=Object(h.a)(u.a.mark((function e(){var t,a,r,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"",a=s.length>1&&void 0!==s[1]?s[1]:{},r=!(s.length>2&&void 0!==s[2])||s[2],e.abrupt("return",n.sendResponse(Object(d.a)({},a,{error:!0,error_message:t}),r));case 4:case"end":return e.stop()}}),e)}))),n.requestToken=Object(h.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.a.send("VKWebAppGetAuthToken",{app_id:7388296,scope:"status"}).then((function(e){return n.setState({userToken:e.access_token,activePanel:"gettingAuth"===n.state.activePanel?n.state.activeHash:n.state.activePanel}),e.access_token})));case 1:case"end":return e.stop()}}),e)}))),n.makeApiCall=function(){var e=Object(h.a)(u.a.mark((function e(t){var a,r,s,i,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.length>1&&void 0!==o[1]?o[1]:{},r=!(o.length>2&&void 0!==o[2])||o[2],s="",!r){e.next=7;break}if(s=btoa(JSON.stringify([t,a])),!n.apiCache[s]){e.next=7;break}return e.abrupt("return",n.apiCache[s]);case 7:if(n.apiCallsCounter%2!==0){e.next=12;break}if(!(n.lastTimeApiCallLastTick-n.lastTimeApiCallFirstTick<=1e3)){e.next=12;break}return console.error("freeze api for ",1e3-(n.lastTimeApiCallLastTick-n.lastTimeApiCallFirstTick)),e.next=12,n.sleep(1e3-(n.lastTimeApiCallLastTick-n.lastTimeApiCallFirstTick));case 12:return i=n.state.userToken,n.apiCallsCounter%2===0&&(n.lastTimeApiCallFirstTick=(new Date).getTime()),n.apiCallsCounter+=1,n.lastTimeApiCallLastTick=(new Date).getTime(),e.abrupt("return",c.a.send("VKWebAppCallAPIMethod",{method:t,request_id:String((new Date).getTime()),params:Object(d.a)({v:"5.103",access_token:i},a)}).then((function(e){return r&&(n.apiCache[s]=e.response),e.response})).catch(function(){var e=Object(h.a)(u.a.mark((function e(r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(6!==r.error_data.error_reason.error_code){e.next=7;break}return console.error(r),e.next=4,n.sleep(500);case 4:return e.abrupt("return",n.makeApiCall(t,a));case 7:throw r;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.queryString=window.location.search,n.lastTimeApiCallLastTick=0,n.lastTimeApiCallFirstTick=0,n.apiCallsCounter=0,n.queryParams=new URLSearchParams(n.queryString),window.isWEB="desktop_web"===n.queryParams.get("vk_platform")||"mobile_web"===n.queryParams.get("vk_platform"),window.isAndroid="mobile_android"===n.queryParams.get("vk_platform")||"mobile_android_messenger"===n.queryParams.get("vk_platform"),window.isIOS="mobile_ios"===n.queryParams.get("vk_platform")||"mobile_ios_messenger"===n.queryParams.get("vk_platform"),n.supportsHashes=["selectCity","selectCountry","getEmail","getPhoneNumber","joinGroup","allowMessagesFromGroup","routeDialog","getAppVersion","readQRCode","downloadFile","fillForm","wallPost","selectChair","selectFaculty","selectUniversity","showStoryBox","selectSchool","selectRegion","selectMetroStation","renderList","selectGeo","getUserInfo","getUserData"],n.databaseMethods=["selectCountry","selectCity","selectChair","selectCountry","selectFaculty","selectUniversity","selectRegion","selectSchool","selectMetroStation"],n.apiCache={},n.wasClosed=!1;var r=window.location.hash.replace(/^#/,"?");return r.replace("?","").match(/^(\d+)/)&&(r="?method=routeDialog&bot_id=".concat(r.replace("?",""))),r=new URLSearchParams(r),n.hashParams=r,n.state={userToken:"",activePanel:"loading",activeHash:"",popout:null,hashParams:r},c.a.subscribe((function(e){e.detail&&("VKWebAppLocationChanged"===e.detail.type||"VKWebAppViewRestore"===e.detail.type&&n.wasClosed||("VKWebAppViewHide"===e.detail.type?n.wasClosed=!0:"VKWebAppUpdateConfig"===e.detail.type&&document.body.setAttribute("scheme",e.detail.data.scheme)))})),n}return Object(m.a)(a,[{key:"componentWillMount",value:function(){this.getAppOptions()}},{key:"getAppOptions",value:function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,n,r,s,i,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.hashParams,(a=new Map).__proto__.getAll=function(e){return a.get(e)},!this.hashParams.get("launch_options")){e.next=22;break}return e.next=6,Object(pe.a)(this.hashParams.get("launch_options")).catch((function(e){throw o.sendError("\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u043e\u0442\u0432\u0435\u0442\u0438\u043b \u0438\u043b\u0438 \u043e\u0442\u0432\u0435\u0442\u0438\u043b \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e",Object(d.a)({},e,{error_code:"launch_options_unavailable"})),e}));case 6:return t=e.sent,e.next=9,t.text();case 9:t=e.sent,e.prev=10,t=JSON.parse(t),e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(10),this.sendError("\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0437\u0430\u043f\u0443\u0441\u043a\u0430",{error_code:"launch_options_invalid_json"}),e.abrupt("return");case 18:for(n in t.options&&"[object Object]"===Object.prototype.toString.call(t)||this.sendError("\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0437\u0430\u043f\u0443\u0441\u043a\u0430. \u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u043e\u043b\u0435 options{} ",{error_code:"launch_options_invalid_format"}),t.options)a.set(n,t.options[n]);a.set("launch_options",this.hashParams.get("launch_options")),t=a;case 22:this.hashParams=t,r=t.get("method"),-1===this.supportsHashes.indexOf(r)&&(r=r&&r.length?"notFound":"hello"),s="gettingAuth",((i="status"===this.queryParams.get("vk_access_token_settings"))||-1===this.databaseMethods.indexOf(r))&&(s=r),i&&this.requestToken(),this.setState({activeHash:r,activePanel:s,hashParams:t});case 30:case"end":return e.stop()}}),e,this,[[10,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){"notFound"===this.state.activeHash&&this.sendError("\u041c\u0435\u0442\u043e\u0434 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",{errror_code:"method_not_found"},!1)}},{key:"sleep",value:function(){var e=Object(h.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){return e(!0)}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.activePanel,t=this.state,a=t.popout,n=t.userToken,s=t.hashParams,i=t.activeHash;return"notFound"===e||"gettingAuth"===e||"hello"===e||n||-1===this.databaseMethods.indexOf(i)||(e="loading"),-1!==this.databaseMethods.indexOf(e)&&(e="selectChair"),"loading"===e?r.a.createElement(y.B,{key:"loading",activePanel:"loading",header:!1},r.a.createElement(y.s,{id:"loading",centered:!0},r.a.createElement(y.u,{size:"xl"}))):r.a.createElement(y.B,{activePanel:e,popout:a,header:!0},r.a.createElement(I,{id:"hello",hashParams:s}),r.a.createElement(x,{id:"notFound",hashParams:s}),r.a.createElement(be,{id:"renderList",activeHash:this.state.activeHash,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(F,{id:"getEmail",activeHash:this.state.activeHash,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(_e,{id:"getUserInfo",activeHash:this.state.activeHash,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(Ce,{id:"getUserData",onRequestToken:this.requestToken,activeHash:this.state.activeHash,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(Z,{id:"wallPost",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(K,{id:"readQRCode",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(D,{id:"downloadFile",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(W,{id:"routeDialog",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(X,{id:"fillForm",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(ae,{id:"showStoryBox",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(U,{id:"joinGroup",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(L,{id:"getAppVersion",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(V,{id:"allowMessagesFromGroup",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(M,{id:"getPhoneNumber",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(C,{id:"selectCity",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,userToken:n,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(te,{id:"selectChair",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,userToken:n,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(ke,{id:"selectGeo",activeHash:this.state.activeHash,sendError:this.sendError,sendResponse:this.sendResponse,userToken:n,vkApi:this.makeApiCall,hashParams:s}),r.a.createElement(S,{hashParams:s,id:"gettingAuth",activeHash:this.state.activeHash,sendError:this.sendError,onRequestToken:this.requestToken}))}}]),a}(r.a.Component));c.a.send("VKWebAppInit"),i.a.render(r.a.createElement(Ee,null),document.getElementById("root")),window.onerror=function(e,t,a,n,r){var s="<br/><pre>"+e+"\n"+t+":"+a+":"+n+"\n"+(r||{}).stack+"</pre><br/>"+window.navigator.userAgent;return document.body.innerHTML=s,console.error(r),console.info(s),!1}}},[[174,1,2]]]);
//# sourceMappingURL=main.1d90dccc.chunk.js.map