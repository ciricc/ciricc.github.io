{#title|Easy VK / Node.JS ВКонтакте API | Streaming API}
<script>
	window.pageGot = true;
</script>
<h1>Streaming API</h1>
<p>
	Streaming API - это удобный инструмент, который может помочь вашим рекламщикам, вашей компании или рекламному агентству собирать данные о популярности тех или иных продуктах / проектах и т.д. Проще говоря, вы подключаете Streaming API к своему серверу или куда-хотите, на пример, в программу, как-то вязанную с метрикой вашего продукта, и затем, собираете данные из ВКонтакте. Как только, какой-то польователь поубликует пост / делает комментарий, в котором идет упоминание вашего продута, вы собираете это в данные затем составляете метрику популярности. Анализ данных, короче говоря.
</p>
<p>
	В EasyVK Streaming API имеет большое приемущество среди остальных возможностей, так как на прямую может принести пользу многим сервисам.
</p>
<p>
	<b>Техническая справка</b>
</p>
<p>
	
	Streaming API работает по протоколу wss:// (или ws://) - WebSocket. 
	Чтобы прослушивать события ВК, необходимо добавить правила (ключевые слова, иначе говоря), по которым будет вестись сбор информации. Если в каком-то блоке информации есть совпадение по вашему правилу, то сервер ВКонтакте сразу (в реальном времени) отправляет эти данные на поток данных, вы в конце получаете эти данные. Данные поступают практически в реальном времени, обычно максимальная задержка - 5 минут (лично сталкивался). 
	В EasyVK вы уже вправе делать с данными то, что хотите.
</p>
<p>
	<b>Примечание</b>
</p> 
<p>
	ВКонтакте предоставляет 1% данных стрима, всех событий. Это необходимо, чтобы не нагружать сервера сильно. Если вам необходимо получить Все 100% данных, чтобы собрать метрику более точной, то необходимо написать в поддержку ВКонтакте (именно по API) с просьбой открыть эту возможность для вашего приложения.

	Если возникнут проблемы при работе со 100% данными, напишите мне в личные сообщения, я отвечу и постараюсь помочь.
</p>
<h2 id="connect">streamingAPI.connect()</h2>
<p>
	Метод подключается к стриму по протоколу <code class="h">wss://</code> и начинает слушать событий стрима, в него необходимо передать данные Вашего приложения ВКонтакте (его можно создать на <a href="https://vk.com/apps?act=manage" target="_blank">этой</a> странице)
</p>
<p>
	Параметры
</p>
<p>
	<ul>
		<li>
			<b>clientId</b> - <span>ID Вашего приложения</span>
		</li>
		<li>
			<b>clientSecret</b> - <span>Секретный ключ Вашего приложения</span>
		</li>
	</ul>
</p>
<p>
	Метод возвращает следующий объект
</p>
<pre class="js"><code>
{
	vk: EasyVK,
	connection: StreamingAPIConnection // Объект стрима, будем работать с ним
}
</code></pre>
<pre class="js"><code>
easyvk.streamingAPI.connect({
	clientId: 'id',
	clientSecret: 'client_secret'
}).then(({connection: stream}) => {
	
	stream.on("post", console.log);
	stream.on("comment", console.log);

});
</code></pre>
<p>Почитайте, как работать со стримом</p>
<h2 id="stream_addRule"><span>#</span>stream.addRule()</h2>
<p>
	Метод добавляет новое правило в стрим
</p>
<p>
	Аргументы
</p>
<p>
	<ul>
		<li><b>tag</b> <span>*</span> <span>(<a href="#">string</a>)</span> - имя правила</li>
		<li><b>value</b> <span>*</span> <span>(<a href="#">string</a>)</span> - само правило, текст правила</li>
	</ul>
</p>
<pre class="js"><code>
stream.addRule('cats', 'кошка кот -собака').then(() => {
	
	console.log('Добавили новое правило!');

})
</code></pre>
<h2 id="stream_deleteRule"><span>#</span>stream.deleteRule()</h2>
<p>
	Метод удаляет правило из стрима
</p>
<p>
	Аргументы
</p>
<p>
	<ul>
		<li><b>tag</b> <span>*</span> <span>(<a href="#">string</a>)</span> - имя правила, которое нужно удалить</li>
	</ul>
</p>
<pre class="js"><code>
stream.addRule('cats', 'кошка кот -собака').then(() => {
	
	console.log('Добавили новое правило!');

	stream.deleteRule('cats').then(() => {
		
		console.log('Удалили правило! Любители кошек, простите!');

	});
	
})
</code></pre>
<h2 id="stream_initRules"><span>#</span>stream.initRules()</h2>
<p>
	Метод управляет всеми правилами стрима. По сути он - это простой менеджер правил, он сам понимает, какие правила нужно удалить, какие добавить. Если в нем есть какое-то правило, которого нет в стриме, он его добавит, и наоборот, если в стриме есть правило, а в нем нет - он его удалит. Удобный инструмент, который заменяет все остальные методы.
</p>
<p>
	Аргументы
</p>
<p>
	<ul>
		<li><b>rules</b> <span>*</span> <span>(<a href="#">object</a>)</span> <span> - объект с правилами, которые теперь будут в точности продублированы в стриме.</span></li>
	</ul>
</p>
<p>
	Метод возвращает объект <code class="h">log</code>, в котором описаны все изменения стрима: удаленные, измененные и добавленные правила
</p>
<pre class="js"><code>
stream.initRules({
	rule_1: 'кошка -собака',
	rule_2: 'попугай'
}).then(({ log }) => {
	
	// Теперь в стриме только эти правила

	console.log(log.changedRules, log.addedRules, log.deletedRules);

});
</code></pre>
<h2 id="stream_deleteAllRules"><span>#</span>stream.deleteAllRules()</h2>
<p>
	Метод тупа удаляет все правила стрима
</p>
<p>
	Не принимает никаких аргументов
</p>
<pre class="js"><code>
stream.addRule('cats', 'кошка кот -собака').then(() => {
	
	console.log('Добавили новое правило!');

	stream.deleteAllRules().then(() => {
		
		console.log('Удалили все правила! Любители кошек, мы с вами!');

	});
	
})
</code></pre>
<h2 id="stream_getRules"><span>#</span>stream.getRules()</h2>
<p>
	Метод возвращает правила стрима
</p>
<p>
	Не принимает никаких аргументов
</p>
<p>
	Возвращает следующий объект
</p>
<pre class="js"><code>
{
	rules: StreamRules,
	vk: EasyVK
}
</code></pre>
<pre class="js"><code>
stream.addRule('cats', 'кошка кот -собака').then(() => {
	
	console.log('Добавили новое правило!');

	stream.getRules().then(({rules}) => {
		
		console.log(rules);

	});
	
})
</code></pre>
<h2 id="stream_close"><span>#</span>stream.close()</h2>
<p>
	Метод закрывает стрим, прекращает прослушивание, правила сохраняются в стриме!
</p>
<pre class="js"><code>
stream.close()
</code></pre>
<h2 id="stream_events"><span>#</span> События стрима</h2>
<p>
	Так как Streaming API предполагает получения информации из стрима в реальном времени, в нем есть определенные события, которые возникают при прослушивании, такие, как, например "пользователь сделала пост" (<code class="h">post</code>) и т.д, подробнее о событиях стрима можно почитать на <a href="https://vk.com/dev/streaming_api_docs_2?f=7.%2B%D0%A7%D1%82%D0%B5%D0%BD%D0%B8%D0%B5%2B%D0%BF%D0%BE%D1%82%D0%BE%D0%BA%D0%B0" target="_blank">странице документации ВКонтакте</a>
</p>
<p>
	<ul>
		<li>
			<b>serviceMessage</b> <span> - Сервисное сообщение</span>
		</li>
		<li>
			<b>error</b> <span> - Событие ошибки в подключении</span>
		</li>
		<li>
			<b>failure</b> <span> - Подключение разорвалось или упало</span>
		</li>
		<li>
			<b>post</b> <span> - Пользователь сделал пост, в котором нашлись совпадения по Вашим правилам стрима</span>
		</li>
		<li>
			<b>comment</b> <span> - Пользователь сделал комментарий, в котором нашлись совпадения по Вашим правилам стрима</span>
		</li>
		<li>
			<b>share</b> <span> - Пользователь сделал репост поста, в котором нашлись совпадения по Вашим правилам стрима</span>
		</li>
	</ul>
</p>
<pre class="js"><code>
	
stream.on('error', console.error)
	.on('failure', console.error)
	.on('serviceMessage', console.log)
	.on('post', console.log)

</code></pre>