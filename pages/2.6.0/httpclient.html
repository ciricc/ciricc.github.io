{#title|Easy VK / Node.JS ВКонтакте API | HTTP клиент}
<script>
	window.pageGot = true;
</script>
<h1>HTTP Клиент</h1>
<p>
	За более подробной информацией об HTTP Клиенте обращайтесь на страницу <a href="http.html">HTTP</a>
</p>
<p>
	После того, как авторизация по HTTP клиенту произошла, Вы получаете объект HTTPClient, его описание идет ниже
</p>
<h2 id="client_readstories">client.readStories()</h2>
<p>
	Метод "просматривает" истории пользователя. Метод просмотрит все доступные истории, или же вы можете указать точно, какую историю хотите просмотреть. 
</p>
<p>
	<h3>Зачем нужно просматривать истории?</h3>
	<p>
		Все просто, официальное API ВКонтакте позволяет только получить истории (картинки, видео), но в Вашем приложении, если пользователь просмотрит видео-историю, просмотр не будет засчитан, и автор истории никогда об этом не узнает. Тем самым этот и другой метод HTTP клиента дополняют API ВКонтакте и делают его шире. Таким образом, Вы можете в своем приложении получать истории из официального Stories API от ВКонтакте, а засчитывать просмотры с помощью данного метода.
	</p>
	<p>
		Кроме того, с помощью этих методов я сделал собственного бота, который "прокачивал" популярность моего аккаунта (читайте <a href="https://pikabu.ru/story/o_tom_kak_ya_ispolzoval_prosmotryi_storis_dlya_piara_v_vk_6123084" target="_blank">статью</a>)
	</p>
</p>
<p>
	Аргументы метода
</p>
<ul>
	<li>
		<b>vk_id</b> <span>*</span> (<a href="#">number</a>) <span class="default"></span>
		<p>
		 	ID пользователя, чьи истории надо просмотреть
		</p>
		<p>
			<pre class="js"><code>
let users = {
	"dayana": {
		id: <a href="https://vk.com/id451196548">451196548</a>,
		male: ...
	}
}

client.readStories(users["dayana"].id).then((count) => {
	
	console.log(count)

})
			</code></pre>
		</p>
	</li>
	<li>
		<b>story_id</b> (<a href="#">number</a>) <span class="default">[0]</span>
		<p>
		 	ID истории, которую нужно просмотреть. Если ID не указан, то будут просмотрены все доступные истории пользователя.
		</p>
		<p>
			<pre class="js"><code>
let users = {
	"dayana": {
		id: <a href="https://vk.com/id451196548">451196548</a>,
		male: ...
	}
}

client.readStories(users["dayana"].id, 34).then((count) => {
	
	console.log(count) // 1

})
			</code></pre>
		</p>
	</li>
</ul>
<h2 id="client_readfeedstories">client.readFeedStories()</h2>
<p>
	Метод просматривает все истории, которые выложены друзьями пользователя за последние 24 часа.
	То есть все истории с главной страницы. Тоже возвращает в <code class="h">resolve</code> функцию переменную <code class="h">count</code> - количество просмотренных историй
</p>
<pre class="js"><code>
client.readFeedStories().then(count => {
	console.log(count)
})
</code></pre>
<h2 id="client_readfeedstories">client.request()</h2>
<p>
	Метод делает подписанный пользовательской сессией запрос на любой внутренний адрес ВКонтакте. С помощью него Вы можете получать любую страницу ВКонтакте такой, как буд-то Вы зашли во ВКонтакте через браузер с выключенным JavaScript.

	Таким же способом Вы можете получать любую другую информацию, которую не можете получить с помощью официального API ВКонтакте. Делать запросы туда, куда нельзя делать через API.
</p>
<p>
	Аргументы метода
</p>
<ul>
	<li>
		<b>file</b> <span>*</span> (<a href="#">string</a>) <span class="default"></span>
		<p>	
			Файл, к которому надо обратиться. Это может быть любой файл, идущий после доменного имени. Например, <code>al_im.php</code>
		</p>
		<pre class="js"><code>// https://vk.com/al_im.php [POST]
client.request('al_im.php').then(console.log)</code></pre>
	</li>
	<li>
		<b>form</b> <span>*</span> (<a href="#">Object</a>) <span class="default"></span>
		<p>	
			Объект (форма, данные), которые нужно отправить по этому запросу
		</p>
		<pre class="js"><code>client.request('al_im.php', {
  act: 'get_emoji_list',
  al: 1,
  sizes: 64,
  sticker_packs_to_load: ''
}).then(console.log)</code></pre>
	</li>
	<li>
		<b>post</b> <span></span> (<a href="#">boolean</a>) <span class="default">true</span>
		<p>	
			Нужно ли отправлять запрос по методу <code>POST</code>
		</p>
	</li>
	<li>
		<b>isMobile</b> <span></span> (<a href="#">boolean</a>) <span class="default">false</span>
		<p>	
			Если Вы выставите это значение как <code>true</code>, то запрос отправится на поддомен <a href="https://m.vk.com" target="_blank">m.vk.com</a>
		</p>
	</li>
</ul>
<p>
	Метод возвращает объект <a href="#">Promise</a>, в <code class="h">resolve</code> функцию при успешном выполнении запроса вернется ответ сервера. <br/>

	Выглядеть такой ответ может как угодно, но на момент написания этих строк (01.03.2020) ВКонтакте в основном на все POST запросы отправляет почти <code>JSON</code>. Почти, потому что это не совсем JSON, в начеле к нему добавляется непонятный префикс <code>&lt;!--</code>, но Easy VK написан так, что, если не получится получить JSON, то он вернет полный ответ сервера независимо от того, что там пришло
</p>
<pre class="js"><code>client.request('al_img.php', {
  act: "a_get_dialogs",
  al: 1,
  gid: 0,
  im_v: 3,
  start_message_id: 0,
  tab: "all"
}).then(res => console.log(res.payload))</code></pre>

<h2 id="client_audio">client.audio</h2>
<p>
	В прошлом Audio API, удален с версии 2.6.0
</p>