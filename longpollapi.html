<!DOCTYPE html>
<html lang="ru-ru">
  <head>
  	
  		<meta charset="utf-8">
		
	<meta name="description" content="EasyVK - это полностью бесплатный и доступный модуль, написанный для поддержки API ВКонтакте на платформе Node.js">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>EasyVK / Node.JS ВКонтакте API | Документация </title>
	
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="icon" href="favicon.ico" type="image/x-icon">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css" type="text/css">
	<link rel="stylesheet" href="assets/css/main.css" type="text/css">



  </head>
  <body>
  	
  	<section class="header">
  	  
  	  <!-- 
  	  	Header section, here are logo and 
  		version selection, news and other... 
  	  -->

			<div class="opacity-block"></div>
	<div class="col-md-12">
		
		<div class="col-md-6">
			<div class="logo">
				<span class="fa fa-bars opener"></span><h2 style="display: inline-block;margin-left: 20px;" class="name-page">EasyVK <span class="small">| документация</span></h2>
			</div>
		</div>

		<div class="col-md-4">
		</div>

	</div>


  	</section>

    <section class="body-develop" style="max-height: 100%;overflow: hidden;">
    
      <!-- Start navigation block, copy/paste id :D -->


      <div class="col-md-3 docs body-elem no-padding" style="max-height: 100%;min-height: 100%;">
        <div class="docs-nav-wrap">
	<ul class="nav">
		<li>
			<a href="index.html" class="title bigger">Знакомство</a>
			<ul>
				<li>
					<a href="index.html#whatisthis">Что такое EasyVK ?</a>
				</li>
				<li>
					<a href="index.html#installation">Установка</a>
				</li>
				<li>
					<a href="index.html#info">Информация</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="easyvk.html" class="title bigger">EasyVK</a>
			<ul>
				<li>
					<a href="easyvk.html#init">Авторизация</a>
				</li>
				<li>
					<a href="easyvk.html#errors">Ловля ошибок</a>
				</li>
				<li>
					<a href="easyvk.html#concepts">История EasyVK</a>
				</li>
				<li class="disable">
					<a href="#">/* API  */</a>
				</li>
				<li>
					<a href="easyvk.html#faq"><b>FAQ</b></a>
				</li>
			</ul>
		</li>
		<li>
			<a href="captcha.html" class="title bigger">Капча</a>
			<ul>
				<li>
					<a href="captcha.html#captchaHandler">captchaHandler</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="methods.html" class="title bigger">Методы</a>
			<ul>
				<li>
					<a href="methods.html#vk_call"><span class="object">vk</span>.<span class="span method">call</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="session.html" class="title bigger">Сессия</a>
			<ul>
				<li>
					<a href="session.html#session_save"><span class="object">session</span>.<span class="span method">save</span>()</a>
				</li>
				<li>
					<a href="session.html#session_setPath"><span class="object">session</span>.<span class="span method">setPath</span>()</a>
				</li>
				<li>
					<a href="session.html#session_clear"><span class="object">session</span>.<span class="span method">clear</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="staticmethods.html" class="title bigger">Статические методы</a>
			<ul>
				<li>
					<a href="staticmethods.html#static_call"><span class="object">static</span>.<span class="span method">call</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_urlencode"><span class="object">static</span>.<span class="span method">urlencode</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_isObject"><span class="object">static</span>.<span class="span method">isObject</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_isString"><span class="object">static</span>.<span class="span method">isString</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_checkJSONErrors"><span class="object">static</span>.<span class="span method">checkJSONErrors</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_checkErrors"><span class="object">static</span>.<span class="span method">checkErrors</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_encodeHTML"><span class="object">static</span>.<span class="span method">encodeHTML</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="streamingapi.html" class="title bigger">Streaming API</a>
			<ul>
				<li>
					<a href="streamingapi.html#streamingAPI_connect"><span class="object">streamingAPI</span>.<span class="span method">connect</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_addRule"><span class="object">stream</span>.<span class="span method">addRule</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_deleteRule"><span class="object">stream</span>.<span class="span method">deleteRule</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_deleteAllRules"><span class="object">stream</span>.<span class="span method">deleteAllRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_close"><span class="object">stream</span>.<span class="span method">close</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_initRules"><span class="object">stream</span>.<span class="span method">initRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_getRules"><span class="object">stream</span>.<span class="span method">getRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#events">События стрима</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="longpollapi.html" class="title bigger"><span class="no-weight">[User]</span> LongPoll API</a>
			<ul>
				<li>
					<a href="longpollapi.html#longpoll_connect"><span class="object">longpoll</span>.<span class="span method">connect</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_addEventCodeListener"><span class="object">connection</span>.<span class="span method">addEventCodeListener</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_debug"><span class="object">connection</span>.<span class="span method">debug</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_close"><span class="object">connection</span>.<span class="span method">close</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="botslongpollapi.html" class="title bigger"><span class="no-weight">[Bots]</span> LongPoll API</a>
			<ul>
				<li>
					<a href="botslongpollapi.html#intro">Описание</a>
				</li>
				<li>
					<a href="botslongpollapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="callbackapi.html" class="title bigger">Callback API</a>
			<ul>
				<li>
					<a href="callbackapi.html#callbackAPI_listen"><span class="object">callbackAPI</span>.<span class="span method">listen</span>()</a>
				</li>
				<li>
					<a href="callbackapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="uploader.html" class="title bigger">Загрузка файлов</a>
			<ul>
				<li>
					<a href="uploader.html#uploader_getUploadURL"><span class="object">uploader</span>.<span class="span method">getUploadURL</span>()</a>
				</li>
				<li>
					<a href="uploader.html#uploader_uploadFile"><span class="object">uploader</span>.<span class="span method">uploadFile</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="widgets.html" class="title bigger">Виджеты</a>
			<ul>
				<li>
					<a href="widgets.html#widgets_getLiveViews"><span class="object">widgets</span>.<span class="span method">getLiveViews</span>()</a>
				</li>
			</ul>
		</li>
	</ul>
</div>
      </div>


      

      <!-- End navigation block, copy/paste id :D -->



      <div class="col-md-9 body-elem" style="max-height: 100%;min-height: 100%;">
          <div class="col-md-11 body-content">
            <!-- Content is here -->
            <h1><span class="no-weight">[User]</span> LongPoll API</h1>
            <p>
             LongPoll API позволяет прослушивать события аккаунта, вроде сообщения или, вступления в группу. LongPoll API с недавних пор разделяют на две части - <a href="https://vk.com/dev/using_longpoll">User LongPoll API</a>, и <a href="https://vk.com/dev/bots_longpoll">Bots LongPoll API</a>, в EasyVK поддерживаются оба типа.
            </p>
            <hr>
             
            Чтобы прослушивать события пользователя - просто используйте свойство longpoll у объекта EasyVK, после анициализации easyvk.
            
            <pre><code class="js">easyvk(/*данные для авторизации*/).then(vk => {
    
    vk.longpoll.connect().then(({connection, vk: EasyVK}) => {
        connection.on('message', console.log)
        console.log(EasyVK === vk) //true        
    })

})</code></pre>
            <div class="theme">
              <h2 id="longpoll_connect">longpoll.connect([settings])</h2>
              <p>
                 Этот метод создает подключение в серверу LongPoll и начинает прослушивать, в штатном режиме этот метод просто подключается к серверу и возвращает в функцию <code class="code">resolve</code> объект такого вида
              </p>
              <pre><code class="js">{
    vk: EasyVK,
    connection: LongPollConnection
}
              </code></pre>
              <p>
                В более расширенном использовании этого метода можно натроить его как вам нужно. На пример, вы можете внести параметры, которые нужны вам на определенных этапах подклюения к LongPoll, для этого передайте в вызов метода объект с такими свойствами: 
              </p>
              <pre><code class="js">const lpSettings = {
    forGetLongPollServer: {
        lp_version: "3", //Изменяем версию LongPoll, в EasyVK используется версия 2
        need_pts: "1"
    }, 
    forLongPollServer: {
        wait: "15" //Ждем ответа 15 секунд
    }
}</code></pre>
            <pre><code class="js">vk.longpoll.connect(lpSettings).then(({connection}) => {
    
    console.log(connection.config)

}).catch(console.error)</code></pre>
            <p>
              <code class="code">forGetLongPollServer</code> - это параметры для запроса на метод <a href="https://vk.com/dev/messages.getLongPollServer">messages.getLongPollServer</a>, вы можете их добавлять и изменять.
            </p>
            <p>
              <code class="code">forLongPollServer</code> - это параметры для каждого запроса к серверу, то есть каждый раз, когда ваш сервер будет запрашивать данные, он будет отправлять эти параметры. Подробнее о них <a href="https://vk.com/dev/using_longpoll?f=1.%20%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5">тут</a>
            </p>
            </div>
            <div class="theme">
              <h2 id="connection_addEventCodeListener">connection.addEventCodeListener(eventCode, handler)</h2>
              <p>
                Так как в User LongPoll все названия событий - это их дентификаторы, то в EasyVK не было смысла прописывать для каждого из них строчное именование, поэтому эту возможность я оставил вам, хоть и не для всех событий, и некоторые события, основные, скажем так, я проименовал.
              </p>
              <pre><code class="js">connection.addEventCodeListener(3, (event) => { 
    
    // Сброс флагов сообщения, например: прочитано
    console.log(event)

})</code></pre>
              <p>
                Теперь каждый раз, когда кто-то будет, например, читать непрочитанное сообщение, будет вызываться <code class="code">handler</code>
              </p>
            </div>
            <div class="theme">
              <h2 id="connection_debug">connection.debug()</h2>
              <p>
                Этот метод подрубает вашу функцию дебагер, в которую каждый раз, когда происходит какое-то событие, будет передаваться ответ сервера, или что-то еще.
              </p>
              <pre><code class="js">function longPollDebugger({type, data}) {
  console.log(`[typeLog ${type}]`, data);
}

vk.longpoll.connect()
.then(({connection}) => {
    connection.debug(longPollDebugger)
})</code></pre>
            </div>
            <div class="theme">
              <h2 id="connection_close">connection.close()</h2>
              <p>
                Данный метод закрывает соединение, не то, чтобы соединение, а скорее, он просто прекращает делать длительные запросы.
              </p>
              <pre><code class="js">connection.close().then(() => {
    console.log('[Closed] LongPoll connection...')   
})</code></pre>
            </div>
            <div class="theme">
              <h2 id="events">События</h2>
              <p>
                В User LongPoll API все события - это по сути числа, их идентификаторы, поэтому в EasyVK поддерживаются лишь определенные события, поддержка остальных событий производится через метод <a href="#connection_addEventCodeListener">connection.addEventCodeListener()</a> 
              </p>
              <table>
                <thead>
                  <tr>
                    <th>ID события</th>
                    <th>Событие</th>
                    <th>Описание</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>4</td>
                    <td>message</td>
                    <td>Пользователь отправил сообщение, либо ему отправили сообщение</td>
                  </tr>
                  <tr>
                    <td>8</td>
                    <td>friendOnline</td>
                    <td>Друг стал онлайн</td>
                  </tr>
                  <tr>
                    <td>51</td>
                    <td>editChat</td>
                    <td>В беседе произошли изменения, например, название сменил Антон</td>
                  </tr>
                  <tr>
                    <td>61</td>
                    <td>typeInDialog</td>
                    <td>Человек пишет в диалоге с пользователем</td>
                  </tr>
                  <tr>
                    <td>62</td>
                    <td>typeInChat</td>
                    <td>Кто-то пишет в беседе</td>
                  </tr>
                  <tr>
                    <td>-</td>
                    <td>error</td>
                    <td>Возникла ошибка в подключении</td>
                  </tr>
                  <tr>
                    <td>-</td>
                    <td>reconnectError</td>
                    <td>Возникла какая-то ошибка при попытки переподключиться, когда какие-то параметры сервера изменяются</td>
                  </tr>
                  <tr>
                    <td>-</td>
                    <td>failure</td>
                    <td>Возникает, когда подключение разрывается, или, сервер слишком долго не отвечает</td>
                  </tr>
                  <tr>
                    <td>-</td>
                    <td>close</td>
                    <td>Возникает, когда подключение закрывается по принуждению</td>
                  </tr>
                </tbody>
              </table>
              <pre><code class="js">vk.longpoll.connect()
.then(({connetion}) => {
  
    connection.on('error', console.error)
    .on('failure', console.error)
    .on('reconnectError', console.error)

    connection.on('messsage', console.log)

})</code></pre>
            </div>
          </div>
      </div>

    </section>

    <link rel="stylesheet" href="assets/css/highlight-theme.css">
<script src="assets/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="assets/js/main.js"></script>

  </body>
</html>
