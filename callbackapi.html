<!DOCTYPE html>
<html lang="ru-ru">
  <head>
  	
  		<meta charset="utf-8">
		
	<meta name="description" content="EasyVK - это полностью бесплатный и доступный модуль, написанный для поддержки API ВКонтакте на платформе Node.js">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	
	<meta property="og:image"              content="https://psv4.userapi.com/c834502/u356607530/docs/d2/7968b5680c4c/logo.png" />
	<meta property="og:title"              content="EasyVK / Node.JS ВКонтакте API | Документация" />
	<meta property="og:description"        content="EasyVK - это полностью бесплатный и доступный модуль, написанный для поддержки API ВКонтакте на платформе Node.js" />


	<title>EasyVK / Node.JS ВКонтакте API | Документация </title>
	
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="icon" href="favicon.ico" type="image/x-icon">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css" type="text/css">
	<link rel="stylesheet" href="assets/css/main.css" type="text/css">



  </head>
  <body>
  	
  	<section class="header">
  	  
  	  <!-- 
  	  	Header section, here are logo and 
  		version selection, news and other... 
  	  -->

			<div class="opacity-block"></div>
	<div class="col-md-12">
		
		<div class="col-md-6">
			<div class="logo">
				<span class="fa fa-bars opener"></span><h2 style="display: inline-block;margin-left: 20px;" class="name-page">EasyVK <span class="small">| документация</span></h2>
			</div>
		</div>

		<div class="col-md-4">
		</div>

	</div>


  	</section>

    <section class="body-develop" style="max-height: 100%;overflow: hidden;">
    
      <!-- Start navigation block, copy/paste id :D -->


      <div class="col-md-3 docs body-elem no-padding" style="max-height: 100%;min-height: 100%;">
        <div class="docs-nav-wrap">
	<ul class="nav">
		<li>
			<a href="index.html" class="title bigger">Знакомство</a>
			<ul>
				<li>
					<a href="index.html#whatisthis">Что такое EasyVK ?</a>
				</li>
				<li>
					<a href="index.html#installation">Установка</a>
				</li>
				<li>
					<a href="index.html#info">Информация</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="easyvk.html" class="title bigger">EasyVK</a>
			<ul>
				<li>
					<a href="easyvk.html#init">Авторизация</a>
				</li>
				<li>
					<a href="easyvk.html#errors">Ловля ошибок</a>
				</li>
				<li>
					<a href="easyvk.html#concepts">История EasyVK</a>
				</li>
				<li class="disable">
					<a href="#">/* API  */</a>
				</li>
				<li>
					<a href="easyvk.html#faq"><b>FAQ</b></a>
				</li>
			</ul>
		</li>
		<li>
			<a href="captcha.html" class="title bigger">Капча</a>
			<ul>
				<li>
					<a href="captcha.html#captchaHandler">captchaHandler</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="methods.html" class="title bigger">Методы</a>
			<ul>
				<li>
					<a href="methods.html#vk_call"><span class="object">vk</span>.<span class="span method">call</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="session.html" class="title bigger">Сессия</a>
			<ul>
				<li>
					<a href="session.html#session_save"><span class="object">session</span>.<span class="span method">save</span>()</a>
				</li>
				<li>
					<a href="session.html#session_setPath"><span class="object">session</span>.<span class="span method">setPath</span>()</a>
				</li>
				<li>
					<a href="session.html#session_clear"><span class="object">session</span>.<span class="span method">clear</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="staticmethods.html" class="title bigger">Статические методы</a>
			<ul>
				<li>
					<a href="staticmethods.html#static_call"><span class="object">static</span>.<span class="span method">call</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_urlencode"><span class="object">static</span>.<span class="span method">urlencode</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_isObject"><span class="object">static</span>.<span class="span method">isObject</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_isString"><span class="object">static</span>.<span class="span method">isString</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_checkJSONErrors"><span class="object">static</span>.<span class="span method">checkJSONErrors</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_checkErrors"><span class="object">static</span>.<span class="span method">checkErrors</span>()</a>
				</li>
				<li>
					<a href="staticmethods.html#static_encodeHTML"><span class="object">static</span>.<span class="span method">encodeHTML</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="streamingapi.html" class="title bigger">Streaming API</a>
			<ul>
				<li>
					<a href="streamingapi.html#streamingAPI_connect"><span class="object">streamingAPI</span>.<span class="span method">connect</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_addRule"><span class="object">stream</span>.<span class="span method">addRule</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_deleteRule"><span class="object">stream</span>.<span class="span method">deleteRule</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_deleteAllRules"><span class="object">stream</span>.<span class="span method">deleteAllRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_close"><span class="object">stream</span>.<span class="span method">close</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_initRules"><span class="object">stream</span>.<span class="span method">initRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#stream_getRules"><span class="object">stream</span>.<span class="span method">getRules</span>()</a>
				</li>
				<li>
					<a href="streamingapi.html#events">События стрима</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="longpollapi.html" class="title bigger"><span class="no-weight">[User]</span> LongPoll API</a>
			<ul>
				<li>
					<a href="longpollapi.html#longpoll_connect"><span class="object">longpoll</span>.<span class="span method">connect</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_addEventCodeListener"><span class="object">connection</span>.<span class="span method">addEventCodeListener</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_debug"><span class="object">connection</span>.<span class="span method">debug</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#connection_close"><span class="object">connection</span>.<span class="span method">close</span>()</a>
				</li>
				<li>
					<a href="longpollapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="botslongpollapi.html" class="title bigger"><span class="no-weight">[Bots]</span> LongPoll API</a>
			<ul>
				<li>
					<a href="botslongpollapi.html#intro">Описание</a>
				</li>
				<li>
					<a href="botslongpollapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="callbackapi.html" class="title bigger">Callback API</a>
			<ul>
				<li>
					<a href="callbackapi.html#callbackAPI_listen"><span class="object">callbackAPI</span>.<span class="span method">listen</span>()</a>
				</li>
				<li>
					<a href="callbackapi.html#events">События</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="uploader.html" class="title bigger">Загрузка файлов</a>
			<ul>
				<li>
					<a href="uploader.html#uploader_getUploadURL"><span class="object">uploader</span>.<span class="span method">getUploadURL</span>()</a>
				</li>
				<li>
					<a href="uploader.html#uploader_uploadFile"><span class="object">uploader</span>.<span class="span method">uploadFile</span>()</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="widgets.html" class="title bigger">Виджеты</a>
			<ul>
				<li>
					<a href="widgets.html#widgets_getLiveViews"><span class="object">widgets</span>.<span class="span method">getLiveViews</span>()</a>
				</li>
			</ul>
		</li>
	</ul>
</div>
      </div>


      

      <!-- End navigation block, copy/paste id :D -->



      <div class="col-md-9 body-elem" style="max-height: 100%;min-height: 100%;">
          <div class="col-md-11 body-content">
             <!-- Content is here -->
             <h1>CallBack API</h1>
             <p>
               CallBack API работает по принципу сервера-приемщика. Ваш сервер просто слушает запросы с сервера ВКонтакте ну или просто разные запросы. ВКонтакте посылает запрос каждый раз, когда происходит какое-то событие. Данный метод передачи событий надежный, но долгий. За место него можно использовать <a href="https://vk.com/dev/bots_longpoll">LongPoll API</a>, будет значительно быстрее. Но, конечно, такой же скорости можно добиться и на CallBack API, просто создав определенные условия для сервера.
             </p>
             <p>
               CallBack API в EasyVK создает сервер и прослушивает все входящие запросы. На запрос <code>GET /</code> он отвечает 404 Not Found, чтобы, если вдруг ваш пользователь найдет сервер бота, он не смог навредить ему, просто уйдя.
             </p>
             <p>
               Далее, сервер слушает POST запросы корня, туда будут присылаться все события. Если POST запрос кто-то скомпромитировал, то вам лучше всего использовать пароль для вашей группы, чтобы никто ничего не мог сделать. События по просту будут игнорироваться, если пароль в них не совпадает с заданным вами.
             </p>
             <p>
               То есть как это происходит. Событие возникает, ваш сервер работает независимо от сервера ВКонтакте, ВКонтакте посылает POST запрос с определенным кодом, с полным событием, EasyVK проверяет, что событие относится к вашей группе, проверяет, что пароль совпадает, если это так, то вызывает событие уже в программе, которое вы можете ловить и делать с ним что-либо. Вот таков путь вашего сообщения.
             </p>
             <hr>
             <pre><code class="js">easyvk.callbackAPI.listen().then(({connection}) => {
    connection.on('message_new', (msg) => {
        console.log('[Got message]', msg)
    })
})</code></pre>
              <div class="theme">
                <h2 id="callbackAPI_listen">callbackAPI.listen()</h2>
                <p>
                  Данный метод создает сервер по заданным вами параметрам и начинает слушать события, которые присылает ему сервер ВКонтакте.
                </p>
                <p>
                  Так как CallBack API предназначен для прослушивания событий группы, вам следует указать EasyVK какую именно группу вы хотите слушать, указать код подтверждения сервера, чтобы ВКонтакте сделал свой первый запрос подтверждения. То есть, чтобы ВК убедились, что это правда ваш сервер, они отправят запрос подтверждения, и EasyVK вернет код подтверждения, который вы укажете в настройках. Код подтверждени берется из настроек группы, когда вы подключаете CallBAckk API. Процедура подтверждения обычно проводится единожды для одной группы, но EasyVK поддерживает и множественное слушание, когда события могут происходит на разных группах, а сервер, который их слушает - один, как и слушатели событий, они не дублируются и вы всегда можете понять в какой именно группе произошло событие. Об этом ниже.
                </p>
                <pre><code class="js">easyvk.callbackAPI.listen({
    port: process.env.PORT || 8080, //Http port для сервера, для heroku process.env.PORT,
    groups: [
       {
        groupId: 11,
        confirmCode: 'TestConfirmationCode',
        secret: 'GroupPassword'
       },
       {
        /*....*/
       }
    ]
}).then(({ connection }) => {
  
    connection.on('message_new', (msg) => {
        
        console.log(msg.group_id)

    })

}).catch(console.error)</code></pre>
                <p>
                  Если вам нужно слушать всего лишь одну группу, необязательно для этого создавать массив <code class="code">groups</code>, для этого можно всего лишь передать <code class="code">groupId</code>, <code class="code">confirmCode</code>, <code class="code">secret</code> в верхний уровень объекта параметров таким образом
                </p>
                <pre><code class="js">easyvk.callbackAPI.listen({
    groupId: '1' //ID группы,
    secret: 'SecretCodeForGroupOrJustPassword',
    confirmCode: 'TestConfirmationCode' //Код подтверждения, единожды для одной группы,
    port: process.env.PORT || 8080
})</code></pre>
                <p>
                  В EasyVK имеется также вариант использования CallBack API после инициализации easyvk таким образом
                </p>
                <pre><code class="js">easyvk(/*параметры авторизации*/).then(vk => {

// Пример
// vk.callbackAPI.listen(/*..*/).then()

}).catch(console.error)</code></pre>
                <p>
                  Также если вам необходимо внести изменения в сервере, вы можете использовать переменную <code class="code">app</code>, это Express Application
                </p>
                <pre><code class="js">vk.callbackAPI.listen().then(({ connection, app, vk }) => {
    app.get('/fold', (req, res) => {
        //Пример
    })
})</code></pre>
              </div>

              <div class="theme">
                <h2 id="events">События</h2>
                <p>
                  В Callback API для EasyVK повторяются все события, которые описаны на <a href="https://vk.com/dev/groups_events" target="_blank">этой</a> странице, а также еть некоторые системные события, которые описаны ниже
                </p>

                <table>
                  <thead>
                    <tr>
                      <th>Событие</th>
                      <th>Описание</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>secretError</td>
                      <td>Возникает, когда сервер пытается отправить событие, но пароль в нем не совпадает с тем, что вы прописали в параметрах группы.</td>
                    </tr>
                    <tr>
                      <td>confirmationError</td>
                      <td>Возникает, когда, сервер пытается отправить запрос подтверждение, но по каким-то причинам в EasyVK нет той группы, которую пытается запросить сервер</td>
                    </tr>
                    <tr>
                      <td>eventEmpty</td>
                      <td>Возникает, когда отправляется запрос, но в нем нету события, и вообще он пустой</td>
                    </tr>
                  </tbody>
                </table>
                <pre><code class="js">function errorHandler ({ postData, description }) {
    console.log(`[${ description }]`, postData)
}

connection.on('eventEmpty', errorHandler)
.on('confirmationError', errorHandler)
.on('secretError', errorHandler)</code></pre>
              </div>

          </div>
      </div>

    </section>

    <link rel="stylesheet" href="assets/css/highlight-theme.css">
<script src="assets/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="assets/js/main.js"></script>

  </body>
</html>
